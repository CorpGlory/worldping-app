{"version":3,"sources":["../../../src/components/probe/probe_details.js"],"names":[],"mappings":"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","file":"probe_details.js","sourcesContent":["export class ProbeDetailsCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location,$timeout, $q, backendSrv, contextSrv, alertSrv) {\n    var self = this;\n    this.contextSrv = contextSrv;\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$location = $location;\n    this.$timeout = $timeout;\n    this.$q = $q;\n    this.pageReady = false;\n    this.probe = null;\n    this.probeUpdates = {};\n    this.showDestroy = false;\n    if ($location.search().probe) {\n      this.getProbe($location.search().probe);\n    } else {\n      this.alertSrv.set(\"no probe id provided.\", \"\", 'error', 10000);\n    }\n    $scope.$on(\"$destroy\", function() {\n      $timeout.cancel(self.poller);\n    });\n  }\n\n  save() {\n    var self = this;\n    return this.backendSrv.put(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to save probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n    });\n  }\n\n  getProbe(id) {\n    var self = this;\n    return this.backendSrv.get(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes/\"+id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probe = resp.body;\n      self.probeUpdates = {name: self.probe.name, public: self.probe.public};\n      if (!self.probe.online) {\n        self.checkIfOnline();\n      }\n    });\n  }\n\n  setEnabled(newState) {\n    var self = this;\n    this.probe.enabled = newState;\n    return this.backendSrv.put('api/plugin-proxy/raintank-worldping-app/api/v2/probes', this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to update probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probe = resp.body;\n    });\n  }\n\n  update() {\n    this.probe.name = this.probeUpdates.name;\n    this.probe.public = this.probeUpdates.public;\n    this.save();\n  }\n\n  remove(probe) {\n    var self = this;\n    return this.backendSrv.delete('api/plugin-proxy/raintank-worldping-app/api/v2/probes/' + probe.id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to delete probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.$location.path('plugins/raintank-worldping-app/page/probes');\n    });\n  }\n\n  gotoDashboard(probe) {\n    this.$location.path(\"/dashboard/db/worldping-probes\").search({\"var-probe\": probe.slug, \"var-endpoint\": \"All\"});\n  }\n\n  gotoEventDashboard(probe) {\n    this.$location.path(\"/dashboard/db/worldping-events\").search({\"var-probe\": probe.slug, \"var-endpoint\": \"All\"});\n  }\n\n  getEventsDashboardLink() {\n    if (!this.probe) {\n      return \"\";\n    }\n    var path = \"/dashboard-solo/db/worldping-events\";\n    var qstring = \"?panelId=1&fullscreen&from=now-1d&to=now&var-probe=\"+this.probe.slug;\n    return path + qstring;\n  }\n\n  checkIfOnline() {\n    var self = this;\n    this.verifyOnline = true;\n\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/probes/'+this.probe.id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n      } else {\n        self.probe = resp.body;\n      }\n      if (!self.probe.online) {\n        self.poller = self.$timeout(function() {\n          self.checkIfOnline();\n        }, 1000);\n      }\n    });\n  }\n}\n\nProbeDetailsCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/probe/partials/probe_details.html';\n"]}