{"version":3,"sources":["../../../src/components/probe/probe_details.js"],"names":[],"mappings":"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","file":"probe_details.js","sourcesContent":["export class ProbeDetailsCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location,$timeout, $q, backendSrv, contextSrv, alertSrv) {\n    var self = this;\n    this.contextSrv = contextSrv;\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$location = $location;\n    this.$timeout = $timeout;\n    this.$q = $q;\n    this.pageReady = false;\n    this.probe = null;\n    this.probeUpdates = {};\n    this.showDestroy = false;\n    if ($location.search().probe) {\n      this.getProbe($location.search().probe);\n    } else {\n      this.alertSrv.set(\"no probe id provided.\", \"\", 'error', 10000);\n    }\n    $scope.$on(\"$destroy\", function() {\n      $timeout.cancel(self.poller);\n    });\n  }\n\n  save() {\n    var self = this;\n    return this.backendSrv.put(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to save probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n    });\n  }\n\n  getProbe(id) {\n    var self = this;\n    return this.backendSrv.get(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes/\"+id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probe = resp.body;\n      self.probeUpdates = {name: self.probe.name, public: self.probe.public};\n      if (!self.probe.online) {\n        self.checkIfOnline();\n      }\n    });\n  }\n\n  setEnabled(newState) {\n    var self = this;\n    this.probe.enabled = newState;\n    return this.backendSrv.put('api/plugin-proxy/raintank-worldping-app/api/v2/probes', this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to update probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probe = resp.body;\n    });\n  }\n\n  update() {\n    this.probe.name = this.probeUpdates.name;\n    this.probe.public = this.probeUpdates.public;\n    this.save();\n  }\n\n  remove(probe) {\n    var self = this;\n    return this.backendSrv.delete('api/plugin-proxy/raintank-worldping-app/api/v2/probes/' + probe.id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to delete probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.$location.path('plugins/raintank-worldping-app/page/probes');\n    });\n  }\n\n  gotoDashboard(probe) {\n    this.$location.path(\"/dashboard/db/worldping-probes\").search({\"var-probe\": probe.slug, \"var-endpoint\": \"All\"});\n  }\n\n  gotoEventDashboard(probe) {\n    this.$location.path(\"/dashboard/db/worldping-events\").search({\"var-probe\": probe.slug, \"var-endpoint\": \"All\"});\n  }\n\n  getEventsDashboardLink() {\n    if (!this.probe) {\n      return \"\";\n    }\n    var path = \"/dashboard-solo/db/worldping-events\";\n    var qstring = \"?panelId=2&fullscreen&from=now-1d&to=now&var-probe=\"+this.probe.slug;\n    return path + qstring;\n  }\n\n  checkIfOnline() {\n    var self = this;\n    this.verifyOnline = true;\n\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/probes/'+this.probe.id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n      } else {\n        self.probe = resp.body;\n      }\n      if (!self.probe.online) {\n        self.poller = self.$timeout(function() {\n          self.checkIfOnline();\n        }, 1000);\n      }\n    });\n  }\n}\n\nProbeDetailsCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/probe/partials/probe_details.html';\n"]}