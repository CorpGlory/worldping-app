{"version":3,"sources":["../../../src/components/probe/probe_details.js"],"names":["DatasourceUpgrader","ProbeDetailsCtrl","$scope","$injector","$location","$timeout","$q","backendSrv","contextSrv","alertSrv","self","pageReady","probe","probeUpdates","showDestroy","search","getProbe","set","$on","cancel","poller","datasourceUpgrader","upgrade","put","then","resp","meta","code","message","reject","id","get","body","name","public","online","checkIfOnline","newState","enabled","save","delete","path","slug","qstring","verifyOnline","templateUrl"],"mappings":"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","file":"probe_details.js","sourcesContent":["import DatasourceUpgrader from '../config/dsUpgrade';\n\nexport class ProbeDetailsCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $timeout, $q, backendSrv, contextSrv, alertSrv) {\n    var self = this;\n    this.contextSrv = contextSrv;\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$location = $location;\n    this.$timeout = $timeout;\n    this.$q = $q;\n    this.pageReady = false;\n    this.probe = null;\n    this.probeUpdates = {};\n    this.showDestroy = false;\n    if ($location.search().probe) {\n      this.getProbe($location.search().probe);\n    } else {\n      this.alertSrv.set(\"no probe id provided.\", \"\", 'error', 10000);\n    }\n    $scope.$on(\"$destroy\", function() {\n      $timeout.cancel(self.poller);\n    });\n    this.datasourceUpgrader = new DatasourceUpgrader(contextSrv, backendSrv, $q);\n    this.datasourceUpgrader.upgrade();\n  }\n\n  save() {\n    var self = this;\n    return this.backendSrv.put(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to save probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n    });\n  }\n\n  getProbe(id) {\n    var self = this;\n    return this.backendSrv.get(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes/\"+id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probe = resp.body;\n      self.probeUpdates = {name: self.probe.name, public: self.probe.public};\n      if (!self.probe.online) {\n        self.checkIfOnline();\n      }\n    });\n  }\n\n  setEnabled(newState) {\n    var self = this;\n    this.probe.enabled = newState;\n    return this.backendSrv.put('api/plugin-proxy/raintank-worldping-app/api/v2/probes', this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to update probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probe = resp.body;\n    });\n  }\n\n  update() {\n    this.probe.name = this.probeUpdates.name;\n    this.probe.public = this.probeUpdates.public;\n    this.save();\n  }\n\n  remove(probe) {\n    var self = this;\n    return this.backendSrv.delete('api/plugin-proxy/raintank-worldping-app/api/v2/probes/' + probe.id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to delete probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.$location.path('plugins/raintank-worldping-app/page/probes');\n    });\n  }\n\n  gotoDashboard(probe) {\n    this.$location.path(\"/dashboard/db/worldping-probes\").search({\"var-probe\": probe.slug, \"var-endpoint\": \"All\"});\n  }\n\n  gotoEventDashboard(probe) {\n    this.$location.path(\"/dashboard/db/worldping-events\").search({\"var-probe\": probe.slug, \"var-endpoint\": \"All\"});\n  }\n\n  getEventsDashboardLink() {\n    if (!this.probe) {\n      return \"\";\n    }\n    var path = \"/dashboard-solo/db/worldping-events\";\n    var qstring = \"?panelId=2&from=now-1d&to=now&var-probe=\"+this.probe.slug;\n    return path + qstring;\n  }\n\n  checkIfOnline() {\n    var self = this;\n    this.verifyOnline = true;\n\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/probes/'+this.probe.id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n      } else {\n        self.probe = resp.body;\n      }\n      if (!self.probe.online) {\n        self.poller = self.$timeout(function() {\n          self.checkIfOnline();\n        }, 1000);\n      }\n    });\n  }\n}\n\nProbeDetailsCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/probe/partials/probe_details.html';\n"]}