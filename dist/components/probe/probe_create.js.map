{"version":3,"sources":["../../../src/components/probe/probe_create.js"],"names":[],"mappings":"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","file":"probe_create.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nvar defaults = {\n  name: '',\n  enabled: true,\n};\n\nclass ProbeCreateCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $window, $q, backendSrv, alertSrv) {\n    var self = this;\n    this.$window = $window;\n    this.$q = $q;\n    this.alertSrv = alertSrv;\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.newProbe = false;\n    this.installMethod = {\n      deb: false,\n      rpm: false,\n      docker: false,\n      manual: false,\n    };\n    this.probe = angular.copy(defaults);\n    this.org = null;\n    this.requiresUpgrade = null;\n\n    if (\"probe\" in $location.search()) {\n      self.getProbe($location.search().probe);\n    } else {\n      self.reset();\n    }\n\n    self.getOrgDetails();\n  }\n\n  setInstallMethod(newMethod) {\n    var self = this;\n    _.forEach(this.installMethod, function(enabled, method) {\n      if (method === newMethod) {\n        self.installMethod[method] = true;\n      } else {\n        self.installMethod[method] = false;\n      }\n    });\n    console.log(this.installMethod);\n  }\n\n  getProbe(id) {\n    var self = this;\n    return this.backendSrv.get(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes/\"+id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probe = resp.body;\n    });\n  }\n\n  getOrgDetails() {\n    var self = this;\n    var p = this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/grafana-net/profile/org');\n    p.then((resp) => {\n      self.org = resp;\n      self.requiresUpgrade = self._requiresUpgrade();\n    }, (resp) => {\n      self.alertSrv.set(\"failed to get Org Details\", resp.statusText, 'error', 10000);\n    });\n    return p;\n  }\n\n  _requiresUpgrade() {\n    if (!this.org) {\n      return true;\n    }\n\n    if (this.org.wpPlan !== '' && this.org.wpPlan !== 'free') {\n      return false;\n    }\n\n    return true;\n  }\n\n  reset() {\n    this.probe = angular.copy(defaults);\n  }\n\n  cancel() {\n    this.reset();\n    this.ignoreChanges = true;\n    this.$window.history.back();\n  }\n\n  save() {\n    var self = this;\n    return this.backendSrv.put(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to save probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n    });\n  }\n\n  add() {\n    var self = this;\n    return this.backendSrv.post(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to add probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.newCollector = true;\n      self.probe = resp.body;\n    });\n  }\n\n  configInfo() {\n    this.showConfigInfo = true;\n  }\n\n  defaultDistro() {\n    this.showDistroConfig = false;\n  }\n\n  otherDistro() {\n    this.showDistroConfig = true;\n  }\n}\n\nProbeCreateCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/probe/partials/probe_create.html';\nexport {\n  ProbeCreateCtrl\n};\n"]}