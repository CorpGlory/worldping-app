{"version":3,"sources":["../../../src/components/probe/probe_create.js"],"names":["angular","_","DatasourceUpgrader","defaults","name","enabled","ProbeCreateCtrl","$scope","$injector","$location","$window","$q","backendSrv","alertSrv","contextSrv","self","newProbe","installMethod","deb","rpm","docker","manual","probe","copy","org","requiresUpgrade","search","getProbe","reset","getOrgDetails","datasourceUpgrader","upgrade","newMethod","forEach","method","console","log","id","get","then","resp","meta","code","set","message","reject","body","p","_requiresUpgrade","statusText","wpPlan","ignoreChanges","history","back","put","post","newCollector","showConfigInfo","showDistroConfig","templateUrl"],"mappings":"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","file":"probe_create.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\nimport DatasourceUpgrader from '../config/dsUpgrade';\n\nvar defaults = {\n  name: '',\n  enabled: true,\n};\n\nclass ProbeCreateCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $window, $q, backendSrv, alertSrv, contextSrv) {\n    var self = this;\n    this.$window = $window;\n    this.$q = $q;\n    this.alertSrv = alertSrv;\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.newProbe = false;\n    this.installMethod = {\n      deb: false,\n      rpm: false,\n      docker: false,\n      manual: false,\n    };\n    this.probe = angular.copy(defaults);\n    this.org = null;\n    this.requiresUpgrade = null;\n\n    if (\"probe\" in $location.search()) {\n      self.getProbe($location.search().probe);\n    } else {\n      self.reset();\n    }\n\n    self.getOrgDetails();\n    this.datasourceUpgrader = new DatasourceUpgrader(contextSrv, backendSrv, $q);\n    this.datasourceUpgrader.upgrade();\n  }\n\n  setInstallMethod(newMethod) {\n    var self = this;\n    _.forEach(this.installMethod, function(enabled, method) {\n      if (method === newMethod) {\n        self.installMethod[method] = true;\n      } else {\n        self.installMethod[method] = false;\n      }\n    });\n    console.log(this.installMethod);\n  }\n\n  getProbe(id) {\n    var self = this;\n    return this.backendSrv.get(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes/\"+id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probe = resp.body;\n    });\n  }\n\n  getOrgDetails() {\n    var self = this;\n    var p = this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/grafana-net/profile/org');\n    p.then((resp) => {\n      self.org = resp;\n      self.requiresUpgrade = self._requiresUpgrade();\n    }, (resp) => {\n      self.alertSrv.set(\"failed to get Org Details\", resp.statusText, 'error', 10000);\n    });\n    return p;\n  }\n\n  _requiresUpgrade() {\n    if (!this.org) {\n      return true;\n    }\n\n    if (this.org.wpPlan !== '' && this.org.wpPlan !== 'free') {\n      return false;\n    }\n\n    return true;\n  }\n\n  reset() {\n    this.probe = angular.copy(defaults);\n  }\n\n  cancel() {\n    this.reset();\n    this.ignoreChanges = true;\n    this.$window.history.back();\n  }\n\n  save() {\n    var self = this;\n    return this.backendSrv.put(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to save probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n    });\n  }\n\n  add() {\n    var self = this;\n    return this.backendSrv.post(\"api/plugin-proxy/raintank-worldping-app/api/v2/probes\", this.probe).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to add probe.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.newCollector = true;\n      self.probe = resp.body;\n    });\n  }\n\n  configInfo() {\n    this.showConfigInfo = true;\n  }\n\n  defaultDistro() {\n    this.showDistroConfig = false;\n  }\n\n  otherDistro() {\n    this.showDistroConfig = true;\n  }\n}\n\nProbeCreateCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/probe/partials/probe_create.html';\nexport {\n  ProbeCreateCtrl\n};\n"]}