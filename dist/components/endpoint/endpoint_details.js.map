{"version":3,"sources":["../../../src/components/endpoint/endpoint_details.js"],"names":[],"mappings":"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","file":"endpoint_details.js","sourcesContent":["import _ from 'lodash';\n\nclass EndpointDetailsCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location,$q, backendSrv, contextSrv, alertSrv) {\n    this.isOrgEditor = contextSrv.hasRole(\"Admin\") || contextSrv.hasRole(\"Editor\");\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$location = $location;\n    this.$q = $q;\n\n    this.pageReady = false;\n    this.endpoint = null;\n\n    if ($location.search().endpoint) {\n      this.getEndpoint($location.search().endpoint);\n    } else {\n      this.alertSrv.set(\"no endpoint id provided.\", \"\", 'error', 10000);\n    }\n\n    this.checktypes = [\n      {name: 'DNS', dashName: 'worldping-endpoint-dns?'},\n      {name: 'Ping', dashName: 'worldping-endpoint-ping?'},\n      {name: 'HTTP', dashName: 'worldping-endpoint-web?var-protocol=http&'},\n      {name: 'HTTPS', dashName: 'worldping-endpoint-web?var-protocol=https&'}\n    ];\n  }\n\n  tagsUpdated() {\n    this.backendSrv.post(\"api/plugin-proxy/raintank-worldping-app/api/endpoints\", this.endpoint);\n  }\n\n  getEndpoint(id) {\n    var self = this;\n\n    self.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/'+id).then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get endpoint.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoint = resp.body;\n      var getProbes = false;\n      _.forEach(self.endpoint.checks, function(check) {\n        if (check.route.type === 'byTags') {\n          getProbes = true;\n        }\n      });\n      if (getProbes) {\n        self.getProbes().then(() => {\n          self.pageReady = true;\n        });\n      } else {\n        self.pageReady = true;\n      }\n    });\n  }\n\n  getProbes() {\n    var self = this;\n    self.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/probes').then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get probes.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probes = resp.body;\n    });\n  }\n\n  getMonitorByTypeName(name) {\n    var check;\n    _.forEach(this.endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === name.toLowerCase()) {\n        check = c;\n      }\n    });\n    return check;\n  }\n\n  monitorStateTxt(type) {\n    var mon = this.getMonitorByTypeName(type);\n    if (typeof(mon) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!mon.enabled) {\n      return \"disabled\";\n    }\n    if (mon.state < 0 || mon.state > 2) {\n      var sinceUpdate = new Date().getTime() - new Date(mon.updated).getTime();\n      if (sinceUpdate < (mon.frequency * 5 * 1000)) {\n        return 'pending';\n      }\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[mon.state];\n  }\n\n  //TODO: move to directive.\n  monitorStateClass(type) {\n    var mon = this.getMonitorByTypeName(type);\n    if (typeof(mon) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!mon.enabled) {\n      return \"disabled\";\n    }\n    if (mon.state < 0 || mon.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[mon.state];\n  }\n\n  stateChangeStr(type) {\n    var mon = this.getMonitorByTypeName(type);\n    if (typeof(mon) !== \"object\") {\n      return \"\";\n    }\n    var duration = new Date().getTime() - new Date(mon.stateChange).getTime();\n    if (duration < 10000) {\n      return \"a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  getProbesForCheck(type) {\n    var check = this.getMonitorByTypeName(type);\n    if (check.route.type === \"byIds\") {\n      return check.route.config.ids;\n    } else if (check.rotue.type === \"byTags\") {\n      var probeList = {};\n      _.forEach(this.probes, function(p) {\n        _.forEach(check.route.config.tags, function(t) {\n          if (_.indexOf(p.tags, t) !== -1) {\n            probeList[p.id] = true;\n          }\n        });\n      });\n      return _.keys(probeList);\n    } else {\n      this.alertSrv(\"check has unknown routing type.\", \"unknown route type.\", \"error\", 5000);\n      return [];\n    }\n  }\n\n  setEndpoint(id) {\n    this.$location.url('plugins/raintank-worldping-app/page/endpoint_details?endpoint='+id);\n  }\n\n  gotoDashboard(endpoint, type) {\n    if (!type) {\n      type = 'summary';\n    }\n    var search = {\n      \"var-probe\": \"All\",\n      \"var-endpoint\": this.endpoint.slug\n    };\n    switch(type.toLowerCase()) {\n      case \"summary\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n      case \"ping\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-ping\").search(search);\n        break;\n      case \"dns\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-dns\").search(search);\n        break;\n      case \"http\":\n        search['var-protocol'] = \"http\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      case \"https\":\n        search['var-protocol'] = \"https\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      default:\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n    }\n  }\n\n  gotoEventDashboard(endpoint, type) {\n    this.$location.url(\"/dashboard/db/worldping-events\").search({\n      \"var-probe\": \"All\",\n      \"var-endpoint\": endpoint.slug,\n      \"var-monitor_type\": type.toLowerCase()\n    });\n  }\n\n  getNotificationEmails(checkType) {\n    var mon = this.getMonitorByTypeName(checkType);\n    if (!mon || mon.healthSettings.notifications.addresses === \"\") {\n      return [];\n    }\n    var addresses = mon.healthSettings.notifications.addresses.split(',');\n    var list = [];\n    addresses.forEach(function(addr) {\n      list.push(addr.trim());\n    });\n    return list;\n  }\n\n  getNotificationEmailsAsString(checkType) {\n    var emails = this.getNotificationEmails(checkType);\n    if (emails.length < 1) {\n      return \"No recipients specified\";\n    }\n    var list = [];\n    emails.forEach(function(email) {\n      // if the email in the format `display name <email@address>`\n      // then just show the display name.\n      var res = email.match(/\\\"?(.+)\\\"?\\s*<.*@.*>/);\n      if (res && res.length === 2) {\n        list.push(res[1]);\n      } else {\n        list.push(email);\n      }\n    });\n    return list.join(\", \");\n  }\n}\n\nEndpointDetailsCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_details.html';\nexport {EndpointDetailsCtrl};\n"]}