{"version":3,"sources":["../../../src/components/endpoint/endpoint_config.js"],"names":["_","angular","defaultRoute","type","config","ids","defaultHealthSettings","num_collectors","steps","defaultCheck","settings","healthSettings","notifications","route","EndpointConfigCtrl","$scope","$injector","$rootScope","$location","$modal","$anchorScroll","$timeout","$window","$q","backendSrv","alertSrv","self","pageReady","showCreating","insufficientQuota","frequencyOpts","freqOpt","forEach","f","push","value","label","newEndpointName","checks","endpoint","probes","probesByTag","ignoreChanges","promises","reset","search","getEndpoint","checkQuota","name","getProbes","all","then","err","set","check","showPing","showDNS","showHTTP","showHTTPS","onbeforeunload","changesPending","$on","event","next","preventDefault","baseLen","absUrl","length","url","nextUrl","substring","modalScope","$new","ignore","save","savePending","appEvent","src","modalClass","scope","idString","id","parseInt","get","resp","meta","code","message","reject","body","cloneDeep","definedChecks","keys","indexOf","q","target","limit","used","probe","tags","t","getProbesForCheck","probeList","p","undefined","reduce","total","enabled","totalChecks","probeCount","frequency","discovered","discoveryInProgress","discoveryError","showConfig","history","back","delete","path","saveEndpoint","i","put","numProbes","num_collector","c","finally","delay","newChecks","post","slug","endpointReadyDelay","endpointReady","changes","seenCheckTypes","equals","templateUrl"],"mappings":"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","file":"endpoint_config.js","sourcesContent":["import _ from 'lodash';\nimport angular from 'angular';\n\nvar defaultRoute = {\n  type: \"byIds\",\n  config: {\n    ids: []\n  }\n};\nvar defaultHealthSettings = {\n  num_collectors: 3,\n  steps: 3\n};\n\nvar defaultCheck = {\n  settings: {},\n  healthSettings: {\n    notifications: {}\n  },\n  route: {\n    type: \"byIds\",\n    config: {\n      \"ids\": []\n    }\n  }\n};\n\nclass EndpointConfigCtrl {\n   /** @ngInject */\n  constructor($scope, $injector, $rootScope, $location, $modal, $anchorScroll, $timeout, $window, $q, backendSrv, alertSrv) {\n    var self = this;\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.$timeout = $timeout;\n    this.$q = $q;\n    this.alertSrv = alertSrv;\n    this.$window = $window;\n\n    this.pageReady = false;\n    this.showCreating = false;\n    self.insufficientQuota = false;\n\n    this.frequencyOpts = [];\n    var freqOpt = [10, 30, 60, 120];\n    _.forEach(freqOpt, function(f) {\n      self.frequencyOpts.push({value: f, label: \"Every \"+f+\"s\"});\n    });\n\n    this.newEndpointName = \"\";\n    this.checks = {};\n    this.endpoint = {};\n    this.probes = [];\n    this.probesByTag = {};\n\n    this.ignoreChanges = false;\n\n    var promises = [];\n    self.reset();\n    if (\"endpoint\" in $location.search()) {\n      promises.push(self.getEndpoint($location.search().endpoint));\n    } else {\n      // make sure we have sufficient quota.\n      promises.push(self.checkQuota());\n      this.endpoint = {name: \"\"};\n    }\n\n    promises.push(this.getProbes());\n    $q.all(promises).then(function() {\n      self.pageReady = true;\n      $timeout(function() {\n        $anchorScroll();\n      }, 0, false);\n    }, function(err) {\n      alertSrv.set(\"endpoint config init failed\", err, 'error', 10000);\n    });\n\n    if ($location.search().check) {\n      switch($location.search().check) {\n      case \"ping\":\n        self.showPing = true;\n        break;\n      case \"dns\":\n        self.showDNS = true;\n        break;\n      case \"http\":\n        self.showHTTP = true;\n        break;\n      case \"https\":\n        self.showHTTPS = true;\n        break;\n      }\n    }\n\n    $window.onbeforeunload = function() {\n      if (self.ignoreChanges) { return; }\n      if (self.changesPending()) {\n        return \"There are unsaved changes to this dashboard\";\n      }\n    };\n\n    $scope.$on('$locationChangeStart', function(event, next) {\n      if ((!self.ignoreChanges) && (self.changesPending())) {\n        event.preventDefault();\n        var baseLen = $location.absUrl().length - $location.url().length;\n        var nextUrl = next.substring(baseLen);\n        var modalScope = $scope.$new();\n        modalScope.ignore = function() {\n          self.ignoreChanges = true;\n          $location.url(nextUrl);\n          return;\n        };\n\n        modalScope.save = function() {\n          self.savePending(nextUrl);\n        };\n\n        $rootScope.appEvent('show-modal', {\n          src: 'public/app/partials/unsaved-changes.html',\n          modalClass: 'confirm-modal',\n          scope: modalScope,\n        });\n      }\n    });\n  }\n\n  getEndpoint(idString) {\n    var self = this;\n    var id = parseInt(idString);\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/'+id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get endpoint.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoint = resp.body;\n      self.newEndpointName = self.endpoint.name;\n      _.forEach(resp.body.checks, function(check) {\n        self.checks[check.type] = _.cloneDeep(check);\n      });\n      var definedChecks = _.keys(self.checks);\n      if (definedChecks.length < 4) {\n        if (_.indexOf(definedChecks, \"http\") === -1) {\n          self.checks[\"http\"] = _.cloneDeep(defaultCheck);\n          self.checks[\"http\"].type = \"http\";\n        }\n        if (_.indexOf(definedChecks, \"https\") === -1) {\n          self.checks[\"https\"] = _.cloneDeep(defaultCheck);\n          self.checks[\"https\"].type = \"https\";\n        }\n        if (_.indexOf(definedChecks, \"ping\") === -1) {\n          self.checks[\"ping\"] = _.cloneDeep(defaultCheck);\n          self.checks[\"ping\"].type = \"ping\";\n        }\n        if (_.indexOf(definedChecks, \"dns\") === -1) {\n          self.checks[\"dns\"] = _.cloneDeep(defaultCheck);\n          self.checks[\"dns\"].type = \"dns\";\n        }\n      }\n    });\n  }\n\n  checkQuota() {\n    var self = this;\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/quotas').then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get quotas.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      _.forEach(resp.body, function(q) {\n        if (q.target === \"endpoint\") {\n          if (q.limit > 0 && q.used >= q.limit) {\n            self.insufficientQuota = true;\n          }\n        }\n      });\n      if (self.insufficientQuota) {\n        return self.$q.reject(\"Endpoint quota reached.\");\n      }\n      return true;\n    });\n  }\n\n  getProbes() {\n    var self = this;\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/probes').then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get getProbes.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.probes = resp.body;\n      defaultRoute.config.ids = [];\n      _.forEach(self.probes, function(probe) {\n        defaultRoute.config.ids.push(probe.id);\n        _.forEach(probe.tags, function(t) {\n          if (!(t in self.probesByTag)) {\n            self.probesByTag[t] = [];\n          }\n          self.probesByTag[t].push(probe);\n        });\n      });\n    });\n  }\n\n  probeCount(check) {\n    if (!check) {\n      return 0;\n    }\n    return this.getProbesForCheck(check).length;\n  }\n\n  getProbesForCheck(check) {\n    if (check.route.type === \"byIds\") {\n      return check.route.config.ids;\n    } else if (check.route.type === \"byTags\") {\n      var probeList = {};\n      _.forEach(this.probes, function(p) {\n        _.forEach(check.route.config.tags, function(t) {\n          if (_.indexOf(p.tags, t) !== -1) {\n            probeList[p.id] = true;\n          }\n        });\n      });\n      return _.keys(probeList);\n    } else {\n      this.alertSrv(\"check has unknown routing type.\", \"unknown route type.\", \"error\", 5000);\n      return [];\n    }\n  }\n\n  totalChecks(check) {\n    if (check === undefined) {\n      var self = this;\n      return _.reduce(self.checks, function(total, value) {\n        if (!value.enabled) {\n          return total;\n        }\n\n        return total + self.totalChecks(value);\n      }, 0);\n    }\n\n    var probeCount = this.probeCount(check);\n    if (probeCount < 1 || check.frequency < 1) {\n      return 0;\n    }\n\n    return (30.5 * 24 * (3600/check.frequency) * probeCount / 1000000) + 0.5;\n  }\n\n  reset() {\n    var self = this;\n    this.discovered = false;\n    this.discoveryInProgress = false;\n    this.discoveryError = false;\n    this.showConfig = false;\n    this.showCreating = false;\n    this.endpoint = {};\n    self.checks = {};\n  }\n\n  cancel() {\n    this.reset();\n    this.ignoreChanges = true;\n    this.$window.history.back();\n  }\n\n  remove(endpoint) {\n    var self = this;\n    return this.backendSrv.delete('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/' + endpoint.id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to delete endpoint.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.$location.path('plugins/raintank-worldping-app/page/endpoints');\n    });\n  }\n\n  updateEndpoint() {\n    this.endpoint.name = this.newEndpointName;\n    this.saveEndpoint();\n  }\n\n  tagsUpdated() {\n    this.saveEndpoint();\n  }\n\n  savePending(nextUrl) {\n    var self = this;\n    _.forEach(this.checks, function(check) {\n      if (!check.id && check.enabled) {\n        //add the check\n        self.endpoint.checks.push(check);\n        return;\n      }\n      for (var i=0; i < self.endpoint.checks.length; i++) {\n        if (self.endpoint.checks[i].id === check.id) {\n          self.endpoint.checks[i] = _.cloneDeep(check);\n        }\n      }\n    });\n    return this.saveEndpoint().then(() => {\n      self.ignoreChanges = true;\n      if (nextUrl) {\n        self.$location.path(nextUrl);\n      } else {\n        self.$location.path(\"plugins/raintank-worldping-app/page/endpoints\");\n      }\n    });\n  }\n\n  saveEndpoint() {\n    var self = this;\n    return this.backendSrv.put('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints', this.endpoint).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to update endpoint.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoint = resp.body;\n    });\n  }\n\n  updateCheck(check) {\n    var self = this;\n\n    if (check.id) {\n      for (var i=0; i < this.endpoint.checks.length; i++) {\n        if (this.endpoint.checks[i].id === check.id) {\n          this.endpoint.checks[i] = _.cloneDeep(check);\n        }\n      }\n    } else {\n      this.endpoint.checks.push(check);\n    }\n    if (check.enabled) {\n      var numProbes = self.probeCount(check);\n      if (numProbes < check.healthSettings.num_collector) {\n        check.healthSettings.num_collectors = numProbes;\n      }\n    }\n    return this.saveEndpoint().then(() => {\n      self.alertSrv.set(check.type + \" check updated.\", \"\", \"success\", 2000);\n      _.forEach(self.endpoint.checks, function(c) {\n        if (c.type === check.type) {\n          self.checks[check.type] = _.cloneDeep(c);\n        }\n      });\n    });\n  }\n\n  skipDiscovery() {\n    this.discoveryInProgress = false;\n    this.showConfig = true;\n    this.discoveryError = false;\n  }\n\n  discover(endpoint) {\n    if (!endpoint.name){\n      return;\n    }\n    var self = this;\n    this.discoveryInProgress = true;\n    this.discoveryError = false;\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/discover', endpoint).then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to update endpoint.\", resp.meta.message, 'error', 10000);\n        this.discoveryError = \"Failed to discover endpoint.\";\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoint = resp.body;\n      _.forEach(self.endpoint.checks, function(check) {\n        check.route = _.cloneDeep(defaultRoute);\n        check.healthSettings = _.cloneDeep(defaultHealthSettings);\n        self.checks[check.type] = _.cloneDeep(check);\n      });\n      var definedChecks = _.keys(self.checks);\n      if (definedChecks.length < 4) {\n        if (_.indexOf(definedChecks, \"http\") === -1) {\n          self.checks[\"http\"] = _.cloneDeep(defaultCheck);\n          self.checks[\"http\"].type = \"http\";\n        }\n        if (_.indexOf(definedChecks, \"https\") === -1) {\n          self.checks[\"https\"] = _.cloneDeep(defaultCheck);\n          self.checks[\"https\"].type = \"https\";\n        }\n        if (_.indexOf(definedChecks, \"ping\") === -1) {\n          self.checks[\"ping\"] = _.cloneDeep(defaultCheck);\n          self.checks[\"ping\"].type = \"ping\";\n        }\n        if (_.indexOf(definedChecks, \"dns\") === -1) {\n          self.checks[\"dns\"] = _.cloneDeep(defaultCheck);\n          self.checks[\"dns\"].type = \"dns\";\n        }\n      }\n      self.showConfig = true;\n      self.discovered = true;\n    }, function() {\n      self.discoveryError = \"Failed to discover endpoint.\";\n    }).finally(function() {\n      self.discoveryInProgress = false;\n    });\n  }\n\n  addEndpoint() {\n    var self = this;\n    var delay = 120;\n    var newChecks = [];\n    _.forEach(this.checks, function(check) {\n      if (check.enabled) {\n        if (check.frequency < delay) {\n          delay = check.frequency;\n        }\n        var numProbes = self.probeCount(check);\n        if (numProbes < 3) {\n          check.healthSettings.num_collectors = numProbes;\n        }\n        newChecks.push(check);\n      }\n    });\n    this.endpoint.checks = newChecks;\n    return this.backendSrv.post('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints', this.endpoint)\n    .then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to add endpoint.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoint.id = resp.body.id;\n      self.endpoint.slug = resp.body.slug;\n      self.ignoreChanges = true;\n      self.alertSrv.set(\"endpoint added\", '', 'success', 3000);\n      self.showCreating = true;\n      self.endpointReadyDelay = delay;\n      self.endpointReady = false;\n      self.$timeout(function() {\n        self.endpointReady = true;\n      }, delay * 1000);\n    });\n  }\n\n  changesPending() {\n    var self = this;\n    var changes = false;\n    var seenCheckTypes = {};\n\n    //check if any existing checks have changed\n    _.forEach(this.endpoint.checks, function(check) {\n      seenCheckTypes[check.type] = true;\n      if (!angular.equals(check, self.checks[check.type])) {\n        changes = true;\n      }\n    });\n\n    //check if any new checks added.\n    _.forEach(_.keys(self.checks), function(type) {\n      if (!(type in seenCheckTypes) && (\"frequency\" in self.checks[type])) {\n        changes = true;\n      }\n    });\n\n    return changes;\n  }\n\n  gotoDashboard(endpoint, type) {\n    var self = this;\n    if (!type) {\n      type = 'summary';\n    }\n    var search = {\n      \"var-collector\": \"All\",\n      \"var-endpoint\": this.endpoint.slug\n    };\n    switch(type) {\n      case \"summary\":\n        self.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n      case \"ping\":\n        self.$location.path(\"/dashboard/db/worldping-endpoint-ping\").search(search);\n        break;\n      case \"dns\":\n        self.$location.path(\"/dashboard/db/worldping-endpoint-dns\").search(search);\n        break;\n      case \"http\":\n        search['var-protocol'] = \"http\";\n        self.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      case \"https\":\n        search['var-protocol'] = \"https\";\n        self.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      default:\n        self.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n    }\n  }\n}\n\nEndpointConfigCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_config.html';\n\nexport {EndpointConfigCtrl};\n"]}