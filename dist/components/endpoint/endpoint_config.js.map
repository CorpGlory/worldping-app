{"version":3,"sources":["../../../src/components/endpoint/endpoint_config.js"],"names":["defaultCheck","checkType","check","_","cloneDeep","_defaultCheck","type","settings","timeout","port","path","headers","body","method","host","downloadLimit","frequency","validateCert","hostname","name","protocol","server","angular","DatasourceUpgrader","healthSettings","notifications","num_collectors","steps","route","config","EndpointConfigCtrl","$scope","$injector","$rootScope","$location","$modal","$anchorScroll","$timeout","$window","$q","backendSrv","alertSrv","contextSrv","self","pageReady","showCreating","insufficientQuota","frequencyOpts","freqOpt","forEach","push","value","f","label","newEndpointName","checks","endpoint","probes","probesByTag","org","quotas","ignoreChanges","promises","reset","search","getEndpoint","getQuotas","checkQuota","getProbes","getOrgDetails","all","then","err","set","showPing","showDNS","showHTTP","showHTTPS","onbeforeunload","changesPending","$on","event","next","preventDefault","baseLen","absUrl","length","url","console","log","nextUrl","substring","modalScope","$new","ignore","save","savePending","appEvent","src","modalClass","scope","datasourceUpgrader","upgrade","idString","id","parseInt","get","resp","meta","code","message","reject","definedChecks","keys","indexOf","q","target","limit","used","probe","tags","t","statusText","getProbesForCheck","ids","probeList","p","undefined","reduce","total","enabled","totalChecks","probeCount","size","toFixed","wpPlan","checksPerMonth","discovered","discoveryInProgress","discoveryError","showConfig","history","back","delete","saveEndpoint","i","put","numProbes","num_collector","c","finally","delay","newChecks","post","slug","endpointReadyDelay","endpointReady","changes","seenCheckTypes","equals","templateUrl"],"mappings":"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","file":"endpoint_config.js","sourcesContent":["import _ from 'lodash';\nimport angular from 'angular';\nimport DatasourceUpgrader from '../config/dsUpgrade';\n\nvar _defaultCheck = {\n  settings: {},\n  healthSettings: {\n    notifications: {},\n    num_collectors: 3,\n    steps: 3\n  },\n  route: {\n    type: \"byIds\",\n    config: {\n      \"ids\": []\n    }\n  }\n};\n\nfunction defaultCheck(checkType) {\n  var check = _.cloneDeep(_defaultCheck);\n  switch (checkType) {\n  case \"http\":\n    check.type = \"http\";\n    check.settings = {\n      timeout: 5,\n      port: 80,\n      path: \"/\",\n      headers: \"User-Agent: worldping-api\\nAccept-Encoding: gzip\\n\",\n      body: '',\n      method: \"GET\",\n      host: \"\",\n      downloadLimit: '',\n    };\n    check.frequency = 120;\n    break;\n  case \"https\":\n    check.type = \"https\";\n    check.settings = {\n      timeout: 5,\n      port: 443,\n      path: \"/\",\n      headers: \"User-Agent: worldping-api\\nAccept-Encoding: gzip\\n\",\n      body: '',\n      method: \"GET\",\n      host: \"\",\n      validateCert: true,\n      downloadLimit: '',\n    };\n    check.frequency = 120;\n    break;\n  case \"ping\":\n    check.type = \"ping\";\n    check.settings = {\n      timeout: 5,\n      hostname: \"\"\n    };\n    check.frequency = 60;\n    break;\n  case \"dns\":\n    check.type = \"dns\";\n    check.settings = {\n      timeout: 5,\n      name: \"\",\n      port: 53,\n      protocol: \"udp\",\n      server: \"\",\n      type: \"A\"\n    };\n    check.frequency = 120;\n    break;\n  }\n  return check;\n}\n\nclass EndpointConfigCtrl {\n   /** @ngInject */\n  constructor($scope, $injector, $rootScope, $location, $modal, $anchorScroll, $timeout, $window, $q, backendSrv, alertSrv, contextSrv) {\n    var self = this;\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.$timeout = $timeout;\n    this.$q = $q;\n    this.alertSrv = alertSrv;\n    this.$window = $window;\n\n    this.pageReady = false;\n    this.showCreating = false;\n    this.insufficientQuota = false;\n\n    this.frequencyOpts = [];\n    var freqOpt = [10, 30, 60, 120];\n    _.forEach(freqOpt, f => {\n      this.frequencyOpts.push({value: f, label: \"Every \"+f+\"s\"});\n    });\n\n    this.newEndpointName = \"\";\n    this.checks = {};\n    this.endpoint = {};\n    this.probes = [];\n    this.probesByTag = {};\n    this.org = null;\n    this.quotas = {};\n\n    this.ignoreChanges = false;\n\n    var promises = [];\n    this.reset();\n    if (\"endpoint\" in $location.search()) {\n      promises.push(this.getEndpoint($location.search().endpoint));\n      promises.push(this.getQuotas());\n    } else {\n      // make sure we have sufficient quota.\n      promises.push(this.checkQuota());\n      this.endpoint = {name: \"\"};\n    }\n\n    promises.push(this.getProbes());\n    promises.push(this.getOrgDetails());\n\n    $q.all(promises).then(() => {\n      this.pageReady = true;\n      $timeout(function() {\n        $anchorScroll();\n      }, 0, false);\n    }, function(err) {\n      alertSrv.set(\"endpoint config init failed\", err, 'error', 10000);\n    });\n\n    if ($location.search().check) {\n      switch($location.search().check) {\n      case \"ping\":\n        this.showPing = true;\n        break;\n      case \"dns\":\n        this.showDNS = true;\n        break;\n      case \"http\":\n        this.showHTTP = true;\n        break;\n      case \"https\":\n        this.showHTTPS = true;\n        break;\n      }\n    }\n\n    $window.onbeforeunload = function() {\n      if (self.ignoreChanges) { return; }\n      if (self.changesPending()) {\n        return \"There are unsaved changes to this dashboard\";\n      }\n    };\n\n    $scope.$on('$locationChangeStart', function(event, next) {\n      if ((!self.ignoreChanges) && (self.changesPending())) {\n        event.preventDefault();\n        var baseLen = $location.absUrl().length - $location.url().length;\n        console.log(\"next: \", next);\n        console.log(\"baseLen: \", baseLen);\n        var nextUrl = next.substring(baseLen);\n        console.log(\"nexUrl: \", nextUrl);\n        var modalScope = $scope.$new();\n        modalScope.ignore = function() {\n          self.ignoreChanges = true;\n          $location.url(nextUrl);\n          return;\n        };\n\n        modalScope.save = function() {\n          self.savePending(nextUrl);\n        };\n\n        $rootScope.appEvent('show-modal', {\n          src: 'public/app/partials/unsaved-changes.html',\n          modalClass: 'confirm-modal',\n          scope: modalScope,\n        });\n      }\n    });\n    this.datasourceUpgrader = new DatasourceUpgrader(contextSrv, backendSrv, $q);\n    this.datasourceUpgrader.upgrade();\n  }\n\n  getEndpoint(idString) {\n    var id = parseInt(idString);\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/'+id).then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to get endpoint.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      this.endpoint = resp.body;\n      this.newEndpointName = this.endpoint.name;\n      _.forEach(resp.body.checks, check => {\n        this.checks[check.type] = _.cloneDeep(check);\n      });\n      var definedChecks = _.keys(this.checks);\n      if (definedChecks.length < 4) {\n        if (_.indexOf(definedChecks, \"http\") === -1) {\n          this.checks[\"http\"] = defaultCheck(\"http\");\n        }\n        if (_.indexOf(definedChecks, \"https\") === -1) {\n          this.checks[\"https\"] = defaultCheck(\"https\");\n        }\n        if (_.indexOf(definedChecks, \"ping\") === -1) {\n          this.checks[\"ping\"] = defaultCheck(\"ping\");\n        }\n        if (_.indexOf(definedChecks, \"dns\") === -1) {\n          this.checks[\"dns\"] = defaultCheck(\"dns\");\n        }\n      }\n    });\n  }\n\n  getQuotas() {\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/quotas').then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to get quotas.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      _.forEach(resp.body, q => {\n        this.quotas[q.target] = q;\n      });\n      return this.quotas;\n    });\n  }\n\n  checkQuota() {\n    return this.getQuotas().then(quotas => {\n      if (quotas.endpoint) {\n        const q = quotas.endpoint;\n        this.insufficientQuota = q.limit > 0 && q.used >= q.limit;\n      }\n      if (this.insufficientQuota) {\n        return this.$q.reject(\"Endpoint quota reached.\");\n      }\n      return true;\n    });\n  }\n\n  getProbes() {\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/probes').then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to get getProbes.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      this.probes = resp.body;\n      _.forEach(this.probes, probe => {\n        _.forEach(probe.tags, t => {\n          if (!(t in this.probesByTag)) {\n            this.probesByTag[t] = [];\n          }\n          this.probesByTag[t].push(probe);\n        });\n      });\n    });\n  }\n\n  getOrgDetails() {\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/grafana-net/profile/org').then(\n      resp => {\n        this.org = resp;\n      },\n      resp => {\n        this.alertSrv.set(\"failed to get Org Details\", resp.statusText, 'error', 10000);\n      }\n    );\n  }\n\n  probeCount(check) {\n    if (!check) {\n      return 0;\n    }\n    return this.getProbesForCheck(check).length;\n  }\n\n  getProbesForCheck(check) {\n    if (check.route.type === \"byIds\") {\n      return check.route.config.ids || [];\n    }\n\n    if (check.route.type === \"byTags\") {\n      var probeList = {};\n      _.forEach(this.probes, p => {\n        _.forEach(check.route.config.tags, t => {\n          if (_.indexOf(p.tags, t) !== -1) {\n            probeList[p.id] = true;\n          }\n        });\n      });\n      return _.keys(probeList);\n    }\n\n    this.alertSrv(\"check has unknown routing type.\", \"unknown route type.\", \"error\", 5000);\n    return [];\n  }\n\n  totalChecks(check) {\n    if (check === undefined) {\n      return _.reduce(this.checks, (total, value) => {\n        if (!value.enabled) {\n          return total;\n        }\n\n        return total + this.totalChecks(value);\n      }, 0);\n    }\n\n    var probeCount = this.probeCount(check);\n    if (probeCount < 1 || check.frequency < 1) {\n      return 0;\n    }\n\n    return (30.4375 * 24 * (3600/check.frequency) * probeCount / 1000000);\n  }\n\n  formatSize(size) {\n    if (size > 1024 * 1024) {\n      return (size / 1024 / 1024).toFixed(2) + ' MB';\n    }\n    if (size > 1024) {\n      return (size / 1024).toFixed(2) + ' KB';\n    }\n    return size;\n  }\n\n  currentlyTrial() {\n    if (!this.org) {\n      return false;\n    }\n\n    if (this.org.wpPlan === 'trial') {\n      return true;\n    }\n\n    return false;\n  }\n\n  requiresUpgrade() {\n    if (!this.org) {\n      return true;\n    }\n\n    if (this.org.wpPlan !== '' && this.org.wpPlan !== 'free' && this.org.wpPlan !== 'trial') {\n      return false;\n    }\n\n    if (this.org.checksPerMonth / 1000000 + this.totalChecks() > 1) {\n      return true;\n    }\n\n    return false;\n  }\n\n  reset() {\n    this.discovered = false;\n    this.discoveryInProgress = false;\n    this.discoveryError = false;\n    this.showConfig = false;\n    this.showCreating = false;\n    this.endpoint = {};\n    this.checks = {};\n  }\n\n  cancel() {\n    this.reset();\n    this.ignoreChanges = true;\n    this.$window.history.back();\n  }\n\n  remove(endpoint) {\n    return this.backendSrv.delete('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/' + endpoint.id).then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to delete endpoint.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      this.$location.path('plugins/raintank-worldping-app/page/endpoints');\n    });\n  }\n\n  updateEndpoint() {\n    this.endpoint.name = this.newEndpointName;\n    this.saveEndpoint();\n  }\n\n  tagsUpdated() {\n    this.saveEndpoint();\n  }\n\n  savePending(nextUrl) {\n    _.forEach(this.checks, check => {\n      if (!check.id && check.enabled) {\n        //add the check\n        this.endpoint.checks.push(check);\n        return;\n      }\n      for (var i=0; i < this.endpoint.checks.length; i++) {\n        if (this.endpoint.checks[i].id === check.id) {\n          this.endpoint.checks[i] = _.cloneDeep(check);\n        }\n      }\n    });\n    return this.saveEndpoint().then(() => {\n      this.ignoreChanges = true;\n      if (nextUrl) {\n        this.$location.url(nextUrl);\n      } else {\n        this.$location.path(\"plugins/raintank-worldping-app/page/endpoints\");\n      }\n    });\n  }\n\n  saveEndpoint() {\n    return this.backendSrv.put('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints', this.endpoint).then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to update endpoint.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      this.endpoint = resp.body;\n    });\n  }\n\n  updateCheck(check) {\n    if (check.enabled) {\n      var numProbes = this.probeCount(check);\n      if (numProbes < check.healthSettings.num_collector) {\n        check.healthSettings.num_collectors = numProbes;\n      }\n      if (check.type === \"http\" || check.type === \"https\") {\n        if (['PUT', 'POST', 'DELETE', 'PATCH'].indexOf(check.settings.method) < 0) {\n          check.settings.body = \"\";\n        }\n      }\n    }\n    if (check.id) {\n      for (var i=0; i < this.endpoint.checks.length; i++) {\n        if (this.endpoint.checks[i].id === check.id) {\n          this.endpoint.checks[i] = _.cloneDeep(check);\n        }\n      }\n    } else {\n      this.endpoint.checks.push(check);\n    }\n    return this.saveEndpoint().then(() => {\n      this.alertSrv.set(check.type + \" check updated.\", \"\", \"success\", 2000);\n      _.forEach(this.endpoint.checks, c => {\n        if (c.type === check.type) {\n          this.checks[check.type] = _.cloneDeep(c);\n        }\n      });\n    });\n  }\n\n  skipDiscovery() {\n    this.discoveryInProgress = false;\n    this.showConfig = true;\n    this.discoveryError = false;\n  }\n\n  discover(endpoint) {\n    if (!endpoint.name){\n      return;\n    }\n    this.discoveryInProgress = true;\n    this.discoveryError = false;\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints/discover', endpoint).then(\n      resp => {\n        if (resp.meta.code !== 200) {\n          this.alertSrv.set(\"failed to update endpoint.\", resp.meta.message, 'error', 10000);\n          this.discoveryError = \"Failed to discover endpoint.\";\n          return this.$q.reject(resp.meta.message);\n        }\n        this.endpoint = resp.body;\n        _.forEach(this.endpoint.checks, check => {\n          this.checks[check.type] = _.cloneDeep(check);\n        });\n        var definedChecks = _.keys(this.checks);\n        if (definedChecks.length < 4) {\n          if (_.indexOf(definedChecks, \"http\") === -1) {\n            this.checks[\"http\"] = defaultCheck(\"http\");\n          }\n          if (_.indexOf(definedChecks, \"https\") === -1) {\n            this.checks[\"https\"] = defaultCheck(\"https\");\n          }\n          if (_.indexOf(definedChecks, \"ping\") === -1) {\n            this.checks[\"ping\"] =defaultCheck(\"ping\");\n          }\n          if (_.indexOf(definedChecks, \"dns\") === -1) {\n            this.checks[\"dns\"] = defaultCheck(\"dns\");\n          }\n        }\n        this.showConfig = true;\n        this.discovered = true;\n      },\n      () => {\n        this.discoveryError = \"Failed to discover endpoint.\";\n      }\n    ).finally(() => {\n      this.discoveryInProgress = false;\n    });\n  }\n\n  addEndpoint() {\n    var self = this;\n    var delay = 120;\n    var newChecks = [];\n    _.forEach(this.checks, check => {\n      if (check.enabled) {\n        if (check.frequency < delay) {\n          delay = check.frequency;\n        }\n        var numProbes = this.probeCount(check);\n        if (numProbes < 3) {\n          check.healthSettings.num_collectors = numProbes;\n        }\n        newChecks.push(check);\n      }\n    });\n    this.endpoint.checks = newChecks;\n    return this.backendSrv.post('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints', this.endpoint).then(resp => {\n      if (resp.meta.code !== 200) {\n        this.alertSrv.set(\"failed to add endpoint.\", resp.meta.message, 'error', 10000);\n        return this.$q.reject(resp.meta.message);\n      }\n      this.endpoint.id = resp.body.id;\n      this.endpoint.slug = resp.body.slug;\n      this.ignoreChanges = true;\n      this.alertSrv.set(\"endpoint added\", '', 'success', 3000);\n      this.showCreating = true;\n      this.endpointReadyDelay = delay;\n      this.endpointReady = false;\n      this.$timeout(function() {\n        self.endpointReady = true;\n      }, delay * 1000);\n    });\n  }\n\n  changesPending() {\n    var changes = false;\n    var seenCheckTypes = {};\n\n    //check if any existing checks have changed\n    _.forEach(this.endpoint.checks, check => {\n      seenCheckTypes[check.type] = true;\n      if (!angular.equals(check, this.checks[check.type])) {\n        changes = true;\n      }\n    });\n\n    //check if any new checks added.\n    _.forEach(this.checks, check => {\n      if (!(check.type in seenCheckTypes) && (\"frequency\" in check)) {\n        changes = true;\n      }\n    });\n\n    return changes;\n  }\n\n  gotoDashboard(endpoint, type) {\n    if (!type) {\n      type = 'summary';\n    }\n    var search = {\n      \"var-collector\": \"All\",\n      \"var-endpoint\": this.endpoint.slug\n    };\n    switch(type) {\n      case \"summary\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n      case \"ping\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-ping\").search(search);\n        break;\n      case \"dns\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-dns\").search(search);\n        break;\n      case \"http\":\n        search['var-protocol'] = \"http\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      case \"https\":\n        search['var-protocol'] = \"https\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      default:\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n    }\n  }\n}\n\nEndpointConfigCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_config.html';\n\nexport {EndpointConfigCtrl};\n"]}