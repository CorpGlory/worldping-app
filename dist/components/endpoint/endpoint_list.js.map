{"version":3,"sources":["../../../src/components/endpoint/endpoint_list.js"],"names":[],"mappings":"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","file":"endpoint_list.js","sourcesContent":["import _ from 'lodash';\n\nclass EndpointListCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $q, backendSrv, contextSrv, alertSrv) {\n    this.isOrgEditor = contextSrv.hasRole('Editor') || contextSrv.hasRole('Admin');\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$q = $q;\n    this.$location = $location;\n    this.pageReady = false;\n    this.filter = {'tag': ''};\n    this.sort_field = 'name';\n    this.endpoints = [];\n    this.refresh();\n    this.endpointState = {\n      \"0\": 0,\n      \"1\": 0,\n      \"2\": 0,\n      \"-1\": 0,\n    };\n  }\n\n  refresh() {\n    this.getEndpoints();\n  }\n\n  endpointTags() {\n    var map = {};\n    _.forEach(this.endpoints, function(endpoint) {\n      _.forEach(endpoint.tags, function(tag) {\n        map[tag] = true;\n      });\n    });\n    return Object.keys(map);\n  }\n\n  setTagFilter(tag) {\n    this.filter.tag = tag;\n  }\n\n  getEndpoints() {\n    var self = this;\n    this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints').then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get endpoint list.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoints = resp.body;\n      self.pageReady = true;\n    });\n  }\n\n  monitorStateTxt(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!check.enabled) {\n      return \"disabled\";\n    }\n    if (check.state < 0 || check.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[check.state];\n  }\n\n  monitorStateChangeStr(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"\";\n    }\n\n    var duration = new Date().getTime() - new Date(check.stateChange).getTime();\n    if (duration < 10000) {\n      return \"for a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  gotoDashboard(endpoint) {\n    this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search({\"var-collector\": \"All\", \"var-endpoint\": endpoint.slug});\n  }\n\n  gotoEndpointURL(endpoint) {\n    this.$location.url('plugins/raintank-worldping-app/page/endpoint-details?endpoint='+ endpoint.id);\n  }\n}\n\nEndpointListCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_list.html';\nexport {EndpointListCtrl};\n"]}