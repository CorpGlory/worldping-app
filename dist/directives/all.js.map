{"version":3,"sources":["../../src/directives/all.js"],"names":[],"mappings":";;;;;;;;;AAAO;;AACA;;;;AAEP,cAAQ,MAAR,CAAe,oBAAf,EAAqC,SAArC,CAA+C,2BAA/C,EAA4E,YAAW;AACrF,eAAO;AACL,uBAAa,wFAAb;AACA,iBAAO;AACL,kBAAM,GAAN;AACA,sBAAU,GAAV;WAFF;SAFF,CADqF;OAAX,CAA5E;;AAUA,cAAQ,MAAR,CAAe,oBAAf,EAAqC,SAArC,CAA+C,eAA/C,EAAgE,UAAS,QAAT,EAAmB,aAAnB,EAAkC,OAAlC,EAA2C;AACzG,eAAO;AACL,uBAAa,4EAAb;AACA,iBAAO;AACL,mBAAO,GAAP;AACA,kBAAM,GAAN;WAFF;AAIA,gBAAM,cAAS,KAAT,EAAgB;AACpB,oBAAQ,IAAR,CAAa;AACX,oBAAM,EAAC,MAAM,UAAQ,MAAM,KAAN,CAAY,SAAZ,GAAwB,EAAxB,CAAR,GAAqC,GAArC,EAA0C,IAAI,KAAJ,EAAvD;aADF,EADoB;AAIpB,gBAAI,eAAe;AACjB,qBAAO,QAAQ,SAAR,EAAP;AACA,wBAAU,QAAQ,SAAR,CAAkB,IAAlB,CAAV;AACA,wBAAU,MAAM,KAAN,CAAY,SAAZ,GAAwB,GAAxB;AACV,uBAAS,CACP,EAAC,QAAQ,YAAU,MAAM,IAAN,CAAW,QAAX,CAAoB,IAApB,GAA2B,KAArC,GACP,MAAM,KAAN,CAAY,IAAZ,CAAiB,WAAjB,EADO,GACwB,yBADxB,EADF,CAAT;AAIA,sBAAQ,MAAR;AACA,6BAAe,EAAf;aATE,CAJgB;;AAgBpB,gBAAI,aAAa,cAAc,GAAd,CAAkB,UAAlB,CAAb,CAhBgB;AAiBpB,uBAAW,IAAX,CAAgB,UAAS,EAAT,EAAa;AAC3B,iBAAG,KAAH,CAAS,YAAT,EAAuB,IAAvB,CAA4B,UAAS,OAAT,EAAkB;AAC5C,2BAAW,OAAX,EAD4C;eAAlB,EAEzB,YAAW;AACZ,2BAAW,EAAC,MAAM,EAAN,EAAZ,EADY;eAAX,CAFH,CAD2B;aAAb,CAAhB,CAjBoB;;AAyBpB,qBAAS,UAAT,CAAoB,OAApB,EAA6B;AAC3B,kBAAI,UAAU,CAAV,CADuB;AAE3B,kBAAI,aAAa,CAAb,CAFuB;AAG3B,kBAAI,eAAe,CAAf,CAHuB;AAI3B,kBAAI,mBAAmB,EAAnB,CAJuB;AAK3B,gBAAE,OAAF,CAAU,QAAQ,IAAR,EAAc,UAAS,MAAT,EAAiB;AACvC,oBAAI,QAAQ,OAAO,MAAP,CAAc,KAAd,CAAoB,GAApB,CAAR,CADmC;AAEvC,oBAAI,WAAW,MAAM,CAAN,CAAX,CAFmC;AAGvC,oBAAI,YAAY,MAAM,CAAN,CAAZ,CAHmC;AAIvC,oBAAI,EAAE,aAAa,gBAAb,CAAF,EAAkC;AACpC,mCAAiB,SAAjB,IAA8B,EAAC,IAAI,CAAC,CAAD,EAAI,OAAO,CAAC,CAAD,EAA9C,CADoC;iBAAtC;;;AAJuC,qBASlC,IAAI,IAAI,OAAO,UAAP,CAAkB,MAAlB,GAA2B,CAA3B,EAA+B,KAAK,CAAL,EAAQ,GAApD,EAAyD;AACvD,sBAAI,QAAQ,OAAO,UAAP,CAAkB,CAAlB,CAAR,CADmD;AAEvD,sBAAI,CAAC,MAAM,MAAM,CAAN,CAAN,CAAD,EAAkB;AACpB,wBAAI,KAAC,CAAM,CAAN,MAAa,CAAb,IAAoB,MAAM,CAAN,IAAW,iBAAiB,SAAjB,EAA4B,EAA5B,EAAiC;AACnE,uCAAiB,SAAjB,EAA4B,EAA5B,GAAiC,MAAM,CAAN,CAAjC,CADmE;AAEnE,8BAAQ,QAAR;AACE,6BAAK,UAAL;AACE,2CAAiB,SAAjB,EAA4B,KAA5B,GAAoC,CAApC,CADF;AAEE,gCAFF;AADF,6BAIO,aAAL;AACE,2CAAiB,SAAjB,EAA4B,KAA5B,GAAoC,CAApC,CADF;AAEE,gCAFF;AAJF;AAQI,2CAAiB,SAAjB,EAA4B,KAA5B,GAAoC,CAAC,CAAD,CADtC;AAEE,kCAAQ,GAAR,CAAY,iDAAZ,EAFF;AAPF,uBAFmE;AAanE,4BAbmE;qBAArE;mBADF;iBAFF;eATsB,CAAxB,CAL2B;AAmC3B,mBAAK,IAAI,GAAJ,IAAW,gBAAhB,EAAkC;AAChC,wBAAQ,iBAAiB,GAAjB,EAAsB,KAAtB;AACR,uBAAK,CAAL;AACE,8BADF;AAEE,0BAFF;AADA,uBAIK,CAAL;AACE,iCADF;AAEE,0BAFF;AAJA;AAQE,mCADF;AAPA,iBADgC;eAAlC;AAYA,kBAAI,WAAW,MAAM,IAAN,CAAW,iBAAX,CAA6B,MAAM,KAAN,CAAY,IAAZ,CAA7B,CAA+C,MAA/C,GAAwD,OAAO,IAAP,CAAY,gBAAZ,EAA8B,MAA9B,CA/C5C;AAgD3B,8BAAgB,QAAhB,CAhD2B;;AAkD3B,oBAAM,OAAN,GAAgB,OAAhB,CAlD2B;AAmD3B,oBAAM,UAAN,GAAmB,UAAnB,CAnD2B;AAoD3B,oBAAM,YAAN,GAAqB,YAArB,CApD2B;AAqD3B,oBAAM,UAAN,GAAmB,IAAnB,CArD2B;aAA7B;WAzBI;SANR,CADyG;OAA3C,CAAhE;;AA2FA,cAAQ,MAAR,CAAe,oBAAf,EAAqC,SAArC,CAA+C,kBAA/C,EAAmE,YAAW;AAC5E,eAAO;AACL,uBAAa,+EAAb;AACA,iBAAO;AACL,sBAAU,GAAV;AACA,kBAAM,GAAN;WAFF;SAFF,CAD4E;OAAX,CAAnE;;AAUA,cAAQ,MAAR,CAAe,oBAAf,EAAqC,SAArC,CAA+C,qBAA/C,EAAsE,UAAS,QAAT,EAAmB,OAAnB,EAA4B,QAA5B,EAAsC;AAC1G,eAAO;AACL,iBAAO;AACL,oBAAQ,GAAR;AACA,mBAAO,GAAP;WAFF;AAIA,uBAAa,wFAAb;AACA,gBAAM,cAAS,KAAT,EAAgB,IAAhB,EAAsB;AAC1B,gBAAI,SAAS,QAAQ,OAAR,CAAgB,QAAQ,QAAR,CAAiB,IAAjB,CAAzB,CADsB;AAE1B,gBAAI,cAAc,EAAd,CAFsB;AAG1B,gBAAI,eAAe,EAAf,CAHsB;;AAK1B,kBAAM,IAAN,GAAa,YAAW;AACtB,kBAAI,MAAM,KAAN,CAAY,KAAZ,CAAkB,IAAlB,KAA2B,OAA3B,EAAoC;AACtC,8BAAc,MAAM,KAAN,CAAY,KAAZ,CAAkB,MAAlB,CAAyB,GAAzB,CADwB;AAEtC,sBAAM,SAAN,GAAkB,EAAC,OAAO,QAAP,EAAnB,CAFsC;eAAxC,MAGO;AACL,+BAAe,MAAM,KAAN,CAAY,KAAZ,CAAkB,MAAlB,CAAyB,IAAzB,CADV;AAEL,sBAAM,SAAN,GAAkB,EAAC,OAAO,SAAP,EAAnB,CAFK;eAHP;AAOA,oBAAM,KAAN,GAAc,KAAd,CARsB;;AAUtB,oBAAM,KAAN,GAVsB;aAAX,CALa;;AAkB1B,kBAAM,KAAN,GAAc,YAAW;AACvB,oBAAM,KAAN,GAAc,KAAd,CADuB;AAEvB,oBAAM,GAAN,GAAY,EAAZ,CAFuB;AAGvB,oBAAM,IAAN,GAAa,EAAb;;AAHuB,kBAKnB,WAAW,EAAX,CALmB;AAMvB,kBAAI,eAAe,EAAE,MAAF,CAAS,MAAM,MAAN,EAAc,UAAS,CAAT,EAAY;AACpD,uBAAO,EAAE,IAAF,CAAO,WAAP,EAAP,CADoD;eAAZ,CAAtC,CANmB;AASvB,gBAAE,OAAF,CAAU,YAAV,EAAwB,UAAS,CAAT,EAAY;AAClC,oBAAI,SAAS,EAAC,IAAI,EAAE,EAAF,EAAM,UAAU,KAAV,EAAiB,MAAM,EAAE,IAAF,EAA3C,CAD8B;AAElC,oBAAI,EAAE,OAAF,CAAU,WAAV,EAAuB,EAAE,EAAF,CAAvB,IAAgC,CAAhC,EAAmC;AACrC,yBAAO,QAAP,GAAkB,IAAlB,CADqC;iBAAvC;AAGA,kBAAE,OAAF,CAAU,EAAE,IAAF,CAAO,IAAP,EAAV,EAAyB,UAAS,CAAT,EAAY;AACnC,sBAAI,EAAE,KAAK,QAAL,CAAF,EAAkB;AACpB,6BAAS,CAAT,IAAc,IAAd,CADoB;AAEpB,wBAAI,IAAI,EAAC,UAAU,KAAV,EAAiB,MAAM,CAAN,EAAtB,CAFgB;AAGpB,wBAAI,EAAE,OAAF,CAAU,YAAV,EAAwB,CAAxB,KAA8B,CAA9B,EAAiC;AACnC,wBAAE,QAAF,GAAa,IAAb,CADmC;qBAArC;AAGA,0BAAM,IAAN,CAAW,IAAX,CAAgB,CAAhB,EANoB;mBAAtB;iBADuB,CAAzB,CALkC;AAelC,sBAAM,GAAN,CAAU,IAAV,CAAe,MAAf,EAfkC;eAAZ,CAAxB,CATuB;AA0BvB,kBAAI,MAAM,SAAN,CAAgB,KAAhB,KAA0B,SAA1B,EAAqC;AACvC,kBAAE,OAAF,CAAU,MAAM,GAAN,EAAW,UAAS,CAAT,EAAY;AAC/B,oBAAE,QAAF,GAAa,KAAb,CAD+B;iBAAZ,CAArB,CADuC;eAAzC,MAIO;AACL,kBAAE,OAAF,CAAU,MAAM,IAAN,EAAY,UAAS,CAAT,EAAY;AAChC,oBAAE,QAAF,GAAa,KAAb,CADgC;iBAAZ,CAAtB,CADK;eAJP;aA1BY,CAlBY;;AAuD1B,kBAAM,IAAN,GAAa,YAAW;AACtB,oBAAM,KAAN,GADsB;AAEtB,oBAAM,YAAN,GAAqB,IAArB,CAFsB;AAGtB,oBAAM,SAAN,GAAkB,CAAlB,CAHsB;;AAKtB,uBAAS,YAAW;AAClB,uBAAO,EAAP,CAAU,OAAV,EAAmB,MAAM,WAAN,CAAnB,CADkB;eAAX,EAEN,CAFH,EAEM,KAFN,EALsB;aAAX,CAvDa;;AAiE1B,kBAAM,UAAN,GAAmB,UAAS,MAAT,EAAiB;AAClC,qBAAO,QAAP,GAAkB,CAAC,OAAO,QAAP,CADe;aAAjB,CAjEO;;AAqE1B,kBAAM,SAAN,GAAkB,YAAW;AAC3B,kBAAI,SAAS,IAAT,CADuB;AAE3B,4BAAc,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,GAAN,EAAW,EAAC,UAAU,IAAV,EAArB,CAAR,EAA+C,IAA/C,CAAd,CAF2B;;AAI3B,kBAAI,YAAY,MAAZ,KAAuB,MAAM,GAAN,CAAU,MAAV,EAAkB;AAC3C,yBAAS,KAAT,CAD2C;eAA7C;AAGA,gBAAE,OAAF,CAAU,MAAM,GAAN,EAAW,UAAS,MAAT,EAAiB;AACpC,uBAAO,QAAP,GAAkB,MAAlB,CADoC;eAAjB,CAArB,CAP2B;aAAX,CArEQ;;AAiF1B,kBAAM,WAAN,GAAoB,UAAS,MAAT,EAAiB;AACnC,qBAAO,QAAP,GAAkB,CAAC,OAAO,QAAP,CADgB;aAAjB,CAjFM;;AAqF1B,kBAAM,cAAN,GAAuB,YAAW;AAChC,kBAAI,YAAY,EAAZ,CAD4B;AAEhC,gBAAE,OAAF,CAAU,MAAM,MAAN,EAAc,UAAS,CAAT,EAAY;AAClC,kBAAE,OAAF,CAAU,EAAE,MAAF,CAAS,MAAM,IAAN,EAAY,EAAC,UAAU,IAAV,EAAtB,CAAV,EAAkD,UAAS,CAAT,EAAY;AAC5D,sBAAI,EAAE,OAAF,CAAU,EAAE,IAAF,EAAQ,EAAE,IAAF,CAAlB,KAA8B,CAAC,CAAD,EAAI;AACpC,8BAAU,EAAE,IAAF,CAAV,GAAoB,IAApB,CADoC;mBAAtC;iBADgD,CAAlD,CADkC;eAAZ,CAAxB,CAFgC;AAShC,qBAAO,OAAO,IAAP,CAAY,SAAZ,EAAuB,IAAvB,CAA4B,IAA5B,CAAP,CATgC;aAAX,CArFG;;AAiG1B,kBAAM,UAAN,GAAmB,UAAS,GAAT,EAAc;AAC/B,kBAAI,QAAQ,CAAR,CAD2B;AAE/B,gBAAE,OAAF,CAAU,MAAM,MAAN,EAAc,UAAS,CAAT,EAAY;AAClC,oBAAI,EAAE,OAAF,CAAU,EAAE,IAAF,EAAQ,IAAI,IAAJ,CAAlB,KAAgC,CAAC,CAAD,EAAI;AACtC,0BADsC;iBAAxC;eADsB,CAAxB,CAF+B;AAO/B,qBAAO,KAAP,CAP+B;aAAd,CAjGO;;AA2G1B,kBAAM,cAAN,GAAuB,YAAW;AAChC,6BAAe,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,IAAN,EAAY,EAAC,UAAU,IAAV,EAAtB,CAAR,EAAgD,MAAhD,CAAf,CADgC;AAEhC,kBAAI,aAAa,MAAb,KAAwB,CAAxB,EAA2B;AAC7B,uBAAO,aAAP,CAD6B;eAA/B;AAGA,kBAAI,aAAa,MAAb,IAAuB,CAAvB,EAA0B;AAC5B,uBAAO,aAAa,IAAb,CAAkB,IAAlB,CAAP,CAD4B;eAA9B;AAGA,qBAAO,aAAa,KAAb,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,IAAzB,CAA8B,IAA9B,IAAsC,OAAtC,IAAiD,aAAa,MAAb,GAAsB,CAAtB,CAAjD,GAA4E,OAA5E,CARyB;aAAX,CA3GG;;AAsH1B,kBAAM,aAAN,GAAsB,YAAW;AAC/B,4BAAc,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,GAAN,EAAW,EAAC,UAAU,IAAV,EAArB,CAAR,EAA+C,IAA/C,CAAd,CAD+B;AAE/B,kBAAI,YAAY,MAAZ,KAAuB,CAAvB,EAA0B;AAC5B,uBAAO,eAAP,CAD4B;eAA9B;AAGA,kBAAI,YAAY,MAAZ,IAAsB,CAAtB,EAAyB;AAC3B,uBAAO,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,GAAN,EAAW,EAAC,UAAU,IAAV,EAArB,CAAR,EAA+C,MAA/C,EAAuD,IAAvD,CAA4D,IAA5D,CAAP,CAD2B;eAA7B;AAGA,qBAAO,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,GAAN,EAAW,EAAC,UAAU,IAAV,EAArB,CAAR,EAA+C,MAA/C,EAAuD,KAAvD,CAA6D,CAA7D,EAAgE,CAAhE,EAAmE,IAAnE,CAAwE,IAAxE,IAAgF,OAAhF,IAA2F,YAAY,MAAZ,GAAqB,CAArB,CAA3F,GAAqH,OAArH,CARwB;aAAX,CAtHI;;AAiI1B,kBAAM,eAAN,GAAwB,YAAW;AACjC,kBAAI,MAAM,SAAN,CAAgB,KAAhB,KAA0B,SAA1B,EAAqC;AACvC,+BAAe,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,IAAN,EAAY,EAAC,UAAU,IAAV,EAAtB,CAAR,EAAgD,MAAhD,CAAf,CADuC;AAEvC,sBAAM,KAAN,CAAY,KAAZ,GAAoB;AAClB,wBAAM,QAAN;AACA,0BAAQ;AACN,0BAAM,EAAN;mBADF;iBAFF,CAFuC;AAQvC,kBAAE,OAAF,CAAU,YAAV,EAAwB,UAAS,CAAT,EAAY;AAClC,wBAAM,KAAN,CAAY,KAAZ,CAAkB,MAAlB,CAAyB,IAAzB,CAA8B,IAA9B,CAAmC,EAAE,IAAF,CAAnC,CADkC;iBAAZ,CAAxB,CARuC;eAAzC,MAWO;AACL,8BAAc,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,GAAN,EAAW,EAAC,UAAU,IAAV,EAArB,CAAR,EAA+C,IAA/C,CAAd,CADK;AAEL,sBAAM,KAAN,CAAY,KAAZ,GAAoB;AAClB,wBAAM,OAAN;AACA,0BAAQ;AACN,yBAAK,EAAL;mBADF;iBAFF,CAFK;AAQL,kBAAE,OAAF,CAAU,WAAV,EAAuB,UAAS,CAAT,EAAY;AACjC,wBAAM,KAAN,CAAY,KAAZ,CAAkB,MAAlB,CAAyB,GAAzB,CAA6B,IAA7B,CAAkC,EAAE,EAAF,CAAlC,CADiC;iBAAZ,CAAvB,CARK;eAXP;aADsB,CAjIE;;AA2J1B,kBAAM,IAAN,GAAa,YAAW;AACtB,kBAAI,MAAM,SAAN,CAAgB,KAAhB,KAA0B,SAA1B,EAAqC;AACvC,sBAAM,KAAN,CAAY,KAAZ,GAAoB;AAClB,wBAAM,QAAN;AACA,0BAAQ;AACN,0BAAM,EAAN;mBADF;iBAFF,CADuC;AAOvC,+BAAe,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,IAAN,EAAY,EAAC,UAAU,IAAV,EAAtB,CAAR,EAAgD,MAAhD,CAAf,CAPuC;AAQvC,kBAAE,OAAF,CAAU,YAAV,EAAwB,UAAS,CAAT,EAAY;AAClC,wBAAM,KAAN,CAAY,KAAZ,CAAkB,MAAlB,CAAyB,IAAzB,CAA8B,IAA9B,CAAmC,CAAnC,EADkC;iBAAZ,CAAxB,CARuC;eAAzC,MAWO;AACL,sBAAM,KAAN,CAAY,KAAZ,GAAoB;AAClB,wBAAM,OAAN;AACA,0BAAQ;AACN,yBAAK,EAAL;mBADF;iBAFF,CADK;AAOL,8BAAc,EAAE,KAAF,CAAQ,EAAE,MAAF,CAAS,MAAM,GAAN,EAAW,EAAC,UAAU,IAAV,EAArB,CAAR,EAA+C,IAA/C,CAAd,CAPK;AAQL,kBAAE,OAAF,CAAU,WAAV,EAAuB,UAAS,CAAT,EAAY;AACjC,wBAAM,KAAN,CAAY,KAAZ,CAAkB,MAAlB,CAAyB,GAAzB,CAA6B,IAA7B,CAAkC,CAAlC,EADiC;iBAAZ,CAAvB,CARK;eAXP;AAuBA,oBAAM,YAAN,GAAqB,KAArB,CAxBsB;AAyBtB,qBAAO,GAAP,CAAW,OAAX,EAAoB,MAAM,WAAN,CAApB,CAzBsB;aAAX,CA3Ja;;AAuL1B,kBAAM,WAAN,GAAoB,UAAS,CAAT,EAAY;AAC9B,kBAAI,WAAW,KAAK,IAAL,CAAU,0BAAV,CAAX,CAD0B;AAE9B,kBAAI,SAAS,GAAT,CAAa,EAAE,MAAF,CAAb,CAAuB,MAAvB,KAAkC,CAAlC,EAAqC;AACvC,sBAAM,MAAN,CAAa,MAAM,IAAN,CAAb,CADuC;eAAzC;aAFkB,CAvLM;;AA8L1B,kBAAM,MAAN,CAAa,UAAb,EAAyB,YAAW;AAClC,oBAAM,IAAN,GADkC;aAAX,CAAzB,CA9L0B;WAAtB;SANR,CAD0G;OAAtC,CAAtE","file":"all.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive(\"rtEndpointHealthDashboard\", function() {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointHealthDashboard.html',\n    scope: {\n      ctrl: \"=\",\n      endpoint: \"=\"\n    }\n  };\n});\n\nangular.module('grafana.directives').directive(\"rtCheckHealth\", function($compile, datasourceSrv, timeSrv) {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/checkHealth.html',\n    scope: {\n      check: \"=\",\n      ctrl: \"=\"\n    },\n    link: function(scope) {\n      timeSrv.init({\n        time: {from: \"now-\"+(scope.check.frequency + 30)+ 's', to: \"now\"}\n      });\n      var metricsQuery = {\n        range: timeSrv.timeRange(),\n        rangeRaw: timeSrv.timeRange(true),\n        interval: scope.check.frequency + 's',\n        targets: [\n          {target: \"litmus.\"+scope.ctrl.endpoint.slug + \".*.\" +\n            scope.check.type.toLowerCase()+\".{ok_state,error_state}\"}\n        ],\n        format: 'json',\n        maxDataPoints: 10,\n      };\n\n      var datasource = datasourceSrv.get('raintank');\n      datasource.then(function(ds) {\n        ds.query(metricsQuery).then(function(results) {\n          showHealth(results);\n        }, function() {\n          showHealth({data: []});\n        });\n      });\n\n      function showHealth(metrics) {\n        var okCount = 0;\n        var errorCount = 0;\n        var unknownCount = 0;\n        var collectorResults = {};\n        _.forEach(metrics.data, function(result) {\n          var parts = result.target.split('.');\n          var stateStr = parts[4];\n          var collector = parts[2];\n          if (!(collector in collectorResults)) {\n            collectorResults[collector] = {ts: -1, state: -1};\n          }\n\n          //start with the last point and work backwards till we find a non-null value.\n          for (var i = result.datapoints.length - 1 ; i >= 0; i--) {\n            var point = result.datapoints[i];\n            if (!isNaN(point[0])) {\n              if ((point[0] === 1) && (point[1] > collectorResults[collector].ts)) {\n                collectorResults[collector].ts = point[1];\n                switch (stateStr) {\n                  case 'ok_state':\n                    collectorResults[collector].state = 0;\n                    break;\n                  case 'error_state':\n                    collectorResults[collector].state = 2;\n                    break;\n                  default:\n                    collectorResults[collector].state = -1;\n                    console.log(\"unknown state returned. this shouldnt happen :(\");\n                }\n                break;\n              }\n            }\n          }\n        });\n        for (var col in collectorResults) {\n          switch (collectorResults[col].state) {\n          case 0:\n            okCount++;\n            break;\n          case 2:\n            errorCount++;\n            break;\n          default:\n            unknownCount++;\n          }\n        }\n        var unknowns = scope.ctrl.getProbesForCheck(scope.check.type).length - Object.keys(collectorResults).length;\n        unknownCount += unknowns;\n\n        scope.okCount = okCount;\n        scope.errorCount = errorCount;\n        scope.unknownCount = unknownCount;\n        scope.eventReady = true;\n      }\n    }\n  };\n});\n\nangular.module('grafana.directives').directive(\"rtEndpointHealth\", function() {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointHealth.html',\n    scope: {\n      endpoint: \"=\",\n      ctrl: \"=\"\n    }\n  };\n});\n\nangular.module('grafana.directives').directive('endpointProbeSelect', function($compile, $window, $timeout) {\n  return {\n    scope: {\n      probes: \"=\",\n      model: \"=\",\n    },\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointCollectorSelect.html',\n    link: function(scope, elem) {\n      var bodyEl = angular.element($window.document.body);\n      var selectedIds = [];\n      var selectedTags = [];\n\n      scope.init = function() {\n        if (scope.model.route.type === 'byIds') {\n          selectedIds = scope.model.route.config.ids;\n          scope.footprint = {value: \"static\"};\n        } else {\n          selectedTags = scope.model.route.config.tags;\n          scope.footprint = {value: \"dynamic\"};\n        }\n        scope.error = false;\n\n        scope.reset();\n      };\n\n      scope.reset = function() {\n        scope.error = false;\n        scope.ids = [];\n        scope.tags = [];\n        //build out our list of collectorIds and tags\n        var seenTags = {};\n        var sortedProbes = _.sortBy(scope.probes, function(o) {\n          return o.name.toLowerCase();\n        });\n        _.forEach(sortedProbes, function(c) {\n          var option = {id: c.id, selected: false, text: c.name};\n          if (_.indexOf(selectedIds, c.id) >= 0) {\n            option.selected = true;\n          }\n          _.forEach(c.tags.sort(), function(t) {\n            if (!(t in seenTags)) {\n              seenTags[t] = true;\n              var o = {selected: false, text: t};\n              if (_.indexOf(selectedTags, t) >= 0) {\n                o.selected = true;\n              }\n              scope.tags.push(o);\n            }\n          });\n          scope.ids.push(option);\n        });\n        if (scope.footprint.value === 'dynamic') {\n          _.forEach(scope.ids, function(i) {\n            i.selected = false;\n          });\n        } else {\n          _.forEach(scope.tags, function(t) {\n            t.selected = false;\n          });\n        }\n      };\n\n      scope.show = function() {\n        scope.reset();\n        scope.selectorOpen = true;\n        scope.giveFocus = 1;\n\n        $timeout(function() {\n          bodyEl.on('click', scope.bodyOnClick);\n        }, 0, false);\n      };\n\n      scope.idSelected = function(option) {\n        option.selected = !option.selected;\n      };\n\n      scope.selectAll = function() {\n        var select = true;\n        selectedIds = _.pluck(_.filter(scope.ids, {selected: true}), \"id\");\n\n        if (selectedIds.length === scope.ids.length) {\n          select = false;\n        }\n        _.forEach(scope.ids, function(option) {\n          option.selected = select;\n        });\n      };\n\n      scope.tagSelected = function(option) {\n        option.selected = !option.selected;\n      };\n\n      scope.probesWithTags = function() {\n        var probeList = {};\n        _.forEach(scope.probes, function(c) {\n          _.forEach(_.filter(scope.tags, {selected: true}), function(t) {\n            if (_.indexOf(c.tags, t.text) !== -1) {\n              probeList[c.name] = true;\n            }\n          });\n        });\n        return Object.keys(probeList).join(', ');\n      };\n\n      scope.probeCount = function(tag) {\n        var count = 0;\n        _.forEach(scope.probes, function(c) {\n          if (_.indexOf(c.tags, tag.text) !== -1) {\n            count++;\n          }\n        });\n        return count;\n      };\n\n      scope.selectTagTitle = function() {\n        selectedTags = _.pluck(_.filter(scope.tags, {selected: true}), \"text\");\n        if (selectedTags.length === 0) {\n          return \"Select Tags\";\n        }\n        if (selectedTags.length <= 2) {\n          return selectedTags.join(\", \");\n        }\n        return selectedTags.slice(0, 2).join(\", \") + \" and \" + (selectedTags.length - 2) + \" more\";\n      };\n\n      scope.selectIdTitle = function() {\n        selectedIds = _.pluck(_.filter(scope.ids, {selected: true}), \"id\");\n        if (selectedIds.length === 0) {\n          return \"Select Probes\";\n        }\n        if (selectedIds.length <= 2) {\n          return _.pluck(_.filter(scope.ids, {selected: true}), \"text\").join(\", \");\n        }\n        return _.pluck(_.filter(scope.ids, {selected: true}), \"text\").slice(0, 2).join(\", \") + \" and \" + (selectedIds.length - 2) + \" more\";\n      };\n\n      scope.routeTypeChange = function() {\n        if (scope.footprint.value === 'dynamic') {\n          selectedTags = _.pluck(_.filter(scope.tags, {selected: true}), \"text\");\n          scope.model.route = {\n            type: \"byTags\",\n            config: {\n              tags: []\n            }\n          };\n          _.forEach(selectedTags, function(t) {\n            scope.model.route.config.tags.push(t.text);\n          });\n        } else {\n          selectedIds = _.pluck(_.filter(scope.ids, {selected: true}), \"id\");\n          scope.model.route = {\n            type: \"byIds\",\n            config: {\n              ids: []\n            }\n          };\n          _.forEach(selectedIds, function(c) {\n            scope.model.route.config.ids.push(c.id);\n          });\n        }\n      };\n\n      scope.hide = function() {\n        if (scope.footprint.value === 'dynamic') {\n          scope.model.route = {\n            type: \"byTags\",\n            config: {\n              tags: []\n            }\n          };\n          selectedTags = _.pluck(_.filter(scope.tags, {selected: true}), \"text\");\n          _.forEach(selectedTags, function(t) {\n            scope.model.route.config.tags.push(t);\n          });\n        } else {\n          scope.model.route = {\n            type: \"byIds\",\n            config: {\n              ids: []\n            }\n          };\n          selectedIds = _.pluck(_.filter(scope.ids, {selected: true}), \"id\");\n          _.forEach(selectedIds, function(c) {\n            scope.model.route.config.ids.push(c);\n          });\n        }\n        scope.selectorOpen = false;\n        bodyEl.off('click', scope.bodyOnClick);\n      };\n\n      scope.bodyOnClick = function(e) {\n        var dropdown = elem.find('.variable-value-dropdown');\n        if (dropdown.has(e.target).length === 0) {\n          scope.$apply(scope.hide);\n        }\n      };\n\n      scope.$watch('model.id', function() {\n        scope.init();\n      });\n    },\n  };\n});\n"]}