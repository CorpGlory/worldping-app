{"version":3,"sources":["../../src/directives/all.js"],"names":["angular","_","module","directive","templateUrl","scope","ctrl","endpoint","$compile","datasourceSrv","timeSrv","check","link","init","time","from","frequency","to","metricsQuery","range","timeRange","rangeRaw","interval","targets","target","slug","type","toLowerCase","format","maxDataPoints","datasource","get","then","ds","query","results","showHealth","data","metrics","okCount","errorCount","unknownCount","collectorResults","forEach","result","parts","split","stateStr","collector","ts","state","i","datapoints","length","point","isNaN","console","log","col","unknowns","getProbesForCheck","Object","keys","eventReady","$window","$timeout","probes","model","elem","bodyEl","element","document","body","selectedIds","selectedTags","route","config","ids","footprint","value","error","reset","sortedProbes","sortBy","o","name","c","option","id","selected","text","indexOf","push","show","selectorOpen","giveFocus","on","bodyOnClick","idSelected","selectAll","select","map","filter","tagSelected","probesWithTags","probeList","tags","t","join","probeCount","tag","count","selectTagTitle","slice","selectIdTitle","hide","off","e","dropdown","find","has","$apply","$watch"],"mappings":"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","file":"all.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive(\"rtEndpointHealthDashboard\", function() {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointHealthDashboard.html',\n    scope: {\n      ctrl: \"=\",\n      endpoint: \"=\"\n    }\n  };\n});\n\nangular.module('grafana.directives').directive(\"rtCheckHealth\", function($compile, datasourceSrv, timeSrv) {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/checkHealth.html',\n    scope: {\n      check: \"=\",\n      ctrl: \"=\"\n    },\n    link: function(scope) {\n      timeSrv.init({\n        time: {from: \"now-\"+(scope.check.frequency + 30)+ 's', to: \"now\"}\n      });\n      var metricsQuery = {\n        range: timeSrv.timeRange(),\n        rangeRaw: timeSrv.timeRange(true),\n        interval: scope.check.frequency + 's',\n        targets: [\n          {target: \"worldping.\"+scope.ctrl.endpoint.slug + \".*.\" +\n            scope.check.type.toLowerCase()+\".{ok_state,error_state}\"}\n        ],\n        format: 'json',\n        maxDataPoints: 10,\n      };\n\n      var datasource = datasourceSrv.get('raintank');\n      datasource.then(function(ds) {\n        ds.query(metricsQuery).then(function(results) {\n          showHealth(results);\n        }, function() {\n          showHealth({data: []});\n        });\n      });\n\n      function showHealth(metrics) {\n        var okCount = 0;\n        var errorCount = 0;\n        var unknownCount = 0;\n        var collectorResults = {};\n        _.forEach(metrics.data, function(result) {\n          var parts = result.target.split('.');\n          var stateStr = parts[4];\n          var collector = parts[2];\n          if (!(collector in collectorResults)) {\n            collectorResults[collector] = {ts: -1, state: -1};\n          }\n\n          //start with the last point and work backwards till we find a non-null value.\n          for (var i = result.datapoints.length - 1 ; i >= 0; i--) {\n            var point = result.datapoints[i];\n            if (!isNaN(point[0])) {\n              if ((point[0] === 1) && (point[1] > collectorResults[collector].ts)) {\n                collectorResults[collector].ts = point[1];\n                switch (stateStr) {\n                  case 'ok_state':\n                    collectorResults[collector].state = 0;\n                    break;\n                  case 'error_state':\n                    collectorResults[collector].state = 2;\n                    break;\n                  default:\n                    collectorResults[collector].state = -1;\n                    console.log(\"unknown state returned. this shouldnt happen :(\");\n                }\n                break;\n              }\n            }\n          }\n        });\n        for (var col in collectorResults) {\n          switch (collectorResults[col].state) {\n          case 0:\n            okCount++;\n            break;\n          case 2:\n            errorCount++;\n            break;\n          default:\n            unknownCount++;\n          }\n        }\n        var unknowns = scope.ctrl.getProbesForCheck(scope.check.type).length - Object.keys(collectorResults).length;\n        unknownCount += unknowns;\n\n        scope.okCount = okCount;\n        scope.errorCount = errorCount;\n        scope.unknownCount = unknownCount;\n        scope.eventReady = true;\n      }\n    }\n  };\n});\n\nangular.module('grafana.directives').directive(\"rtEndpointHealth\", function() {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointHealth.html',\n    scope: {\n      endpoint: \"=\",\n      ctrl: \"=\"\n    }\n  };\n});\n\nangular.module('grafana.directives').directive('endpointProbeSelect', function($compile, $window, $timeout) {\n  return {\n    scope: {\n      probes: \"=\",\n      model: \"=\",\n    },\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointCollectorSelect.html',\n    link: function(scope, elem) {\n      var bodyEl = angular.element($window.document.body);\n      var selectedIds = [];\n      var selectedTags = [];\n\n      scope.init = function() {\n        selectedIds = scope.model.route.config.ids;\n        scope.footprint = {value: \"static\"};\n        scope.error = false;\n        scope.reset();\n      };\n\n      scope.reset = function() {\n        scope.error = false;\n        scope.ids = [];\n        //build out our list of collectorIds\n        var sortedProbes = _.sortBy(scope.probes, function(o) {\n          return o.name.toLowerCase();\n        });\n        _.forEach(sortedProbes, function(c) {\n          var option = {id: c.id, selected: false, text: c.name};\n          if (_.indexOf(selectedIds, c.id) >= 0) {\n            option.selected = true;\n          }\n          scope.ids.push(option);\n        });\n      };\n\n      scope.show = function() {\n        scope.reset();\n        scope.selectorOpen = true;\n        scope.giveFocus = 1;\n\n        $timeout(function() {\n          bodyEl.on('click', scope.bodyOnClick);\n        }, 0, false);\n      };\n\n      scope.idSelected = function(option) {\n        option.selected = !option.selected;\n      };\n\n      scope.selectAll = function() {\n        var select = true;\n        selectedIds = _.map(_.filter(scope.ids, {selected: true}), \"id\");\n\n        if (selectedIds.length === scope.ids.length) {\n          select = false;\n        }\n        _.forEach(scope.ids, function(option) {\n          option.selected = select;\n        });\n      };\n\n      scope.tagSelected = function(option) {\n        option.selected = !option.selected;\n      };\n\n      scope.probesWithTags = function() {\n        var probeList = {};\n        _.forEach(scope.probes, function(c) {\n          _.forEach(_.filter(scope.tags, {selected: true}), function(t) {\n            if (_.indexOf(c.tags, t.text) !== -1) {\n              probeList[c.name] = true;\n            }\n          });\n        });\n        return Object.keys(probeList).join(', ');\n      };\n\n      scope.probeCount = function(tag) {\n        var count = 0;\n        _.forEach(scope.probes, function(c) {\n          if (_.indexOf(c.tags, tag.text) !== -1) {\n            count++;\n          }\n        });\n        return count;\n      };\n\n      scope.selectTagTitle = function() {\n        selectedTags = _.map(_.filter(scope.tags, {selected: true}), \"text\");\n        if (selectedTags.length === 0) {\n          return \"Select Tags\";\n        }\n        if (selectedTags.length <= 2) {\n          return selectedTags.join(\", \");\n        }\n        return selectedTags.slice(0, 2).join(\", \") + \" and \" + (selectedTags.length - 2) + \" more\";\n      };\n\n      scope.selectIdTitle = function() {\n        selectedIds = _.map(_.filter(scope.ids, {selected: true}), \"id\");\n        if (selectedIds.length === 0) {\n          return \"Select Probes\";\n        }\n        if (selectedIds.length <= 2) {\n          return _.map(_.filter(scope.ids, {selected: true}), \"text\").join(\", \");\n        }\n        return _.map(_.filter(scope.ids, {selected: true}), \"text\").slice(0, 2).join(\", \") + \" and \" + (selectedIds.length - 2) + \" more\";\n      };\n\n      scope.hide = function() {\n        scope.model.route = {\n          type: \"byIds\",\n          config: {\n            ids: []\n          }\n        };\n        selectedIds = _.map(_.filter(scope.ids, {selected: true}), \"id\");\n        _.forEach(selectedIds, function(c) {\n          scope.model.route.config.ids.push(c);\n        });\n        scope.selectorOpen = false;\n        bodyEl.off('click', scope.bodyOnClick);\n      };\n\n      scope.bodyOnClick = function(e) {\n        var dropdown = elem.find('.variable-value-dropdown');\n        if (dropdown.has(e.target).length === 0) {\n          scope.$apply(scope.hide);\n        }\n      };\n\n      scope.$watch('model.id', function() {\n        scope.init();\n      });\n    },\n  };\n});\n"]}