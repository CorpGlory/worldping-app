{"version":3,"sources":["../../../src/panels/call-to-action/module.js"],"names":["_","PanelCtrl","loadPluginCss","dark","light","CallToActionCtrl","$scope","$injector","$location","$q","backendSrv","alertSrv","quotas","endpointStatus","collectorStatus","getOrgDetails","endpoint","used","probe","self","p","get","then","resp","org","requiresUpgrade","_requiresUpgrade","set","statusText","wpPlan","meta","code","message","reject","quotaHash","forEach","body","q","target","setEndpointStatus","setCollectorStatus","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import _ from 'lodash';\nimport {PanelCtrl} from 'app/plugins/sdk';\nimport {loadPluginCss} from 'app/plugins/sdk';\n\nloadPluginCss({\n  dark: 'plugins/raintank-worldping-app/css/worldping.dark.css',\n  light: 'plugins/raintank-worldping-app/css/worldping.light.css'\n});\n\nclass CallToActionCtrl extends PanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $q, backendSrv, alertSrv) {\n    super($scope, $injector);\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$location = $location;\n    this.$q = $q;\n\n    this.quotas = null;\n    this.endpointStatus = \"scopeEndpoints\";\n    this.collectorStatus = \"scopeCollectors\";\n\n    this.getOrgDetails();\n  }\n\n  setEndpointStatus() {\n    if (! this.quotas) {\n      return;\n    }\n    if (this.quotas.endpoint.used === 0) {\n      this.endpointStatus = \"noEndpoints\";\n      return;\n    }\n    if (this.quotas.endpoint.used >= 1) {\n      this.endpointStatus = \"hasEndpoints\";\n      return;\n    }\n    //default.\n    this.endpointStatus = \"hasEndpoints\";\n    return;\n  }\n\n  setCollectorStatus() {\n    if (! this.quotas) {\n      return;\n    }\n    if (this.quotas.probe.used === 0) {\n      this.collectorStatus = \"noCollectors\";\n      return;\n    }\n    if (this.quotas.probe.used >= 1) {\n      this.collectorStatus = \"hasCollectors\";\n      return;\n    }\n    //default.\n    this.collectorStatus = \"hasCollectors\";\n    return;\n  }\n\n  getOrgDetails() {\n    var self = this;\n    var p = this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/grafana-net/profile/org');\n    p.then((resp) => {\n      self.org = resp;\n      self.requiresUpgrade = self._requiresUpgrade();\n    }, (resp) => {\n      self.alertSrv.set(\"failed to get Org Details\", resp.statusText, 'error', 10000);\n    });\n    return p;\n  }\n\n  _requiresUpgrade() {\n    if (!this.org) {\n      return true;\n    }\n\n    if (this.org.wpPlan !== '' && this.org.wpPlan !== 'free') {\n      return false;\n    }\n\n    return true;\n  }\n\n  allDone() {\n    if (! this.quotas) {\n      return false;\n    }\n    if (this.quotas.probe.used === 0) {\n      return false;\n    }\n    if (this.quotas.endpoint.used === 0) {\n      return false;\n    }\n    //default.\n    return true;\n  }\n\n  refresh() {\n    var self = this;\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/quotas').then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get quotas.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      var quotaHash = {};\n      _.forEach(resp.body, function(q) {\n        quotaHash[q.target] = q;\n      });\n      self.quotas = quotaHash;\n      self.setEndpointStatus();\n      self.setCollectorStatus();\n    });\n  }\n}\n\nCallToActionCtrl.templateUrl = 'public/plugins/raintank-worldping-app/panels/call-to-action/module.html';\n\nexport {\n  CallToActionCtrl as PanelCtrl\n};\n"]}