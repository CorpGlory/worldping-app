{"version":3,"sources":["../../../src/panels/call-to-action/module.js"],"names":[],"mappings":"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","file":"module.js","sourcesContent":["import _ from 'lodash';\nimport {PanelCtrl} from 'app/plugins/sdk';\nimport {loadPluginCss} from 'app/plugins/sdk';\n\nloadPluginCss({\n  dark: 'plugins/raintank-worldping-app/css/worldping.dark.css',\n  light: 'plugins/raintank-worldping-app/css/worldping.light.css'\n});\n\nclass CallToActionCtrl extends PanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $q, backendSrv, alertSrv) {\n    super($scope, $injector);\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$location = $location;\n    this.$q = $q;\n\n    this.quotas = null;\n    this.endpointStatus = \"scopeEndpoints\";\n    this.collectorStatus = \"scopeCollectors\";\n    this.requiresUpgrade = null;\n    this.aboveFreeTier = null;\n\n    this.getOrgDetails();\n  }\n\n  setEndpointStatus() {\n    if (! this.quotas) {\n      return;\n    }\n    if (this.quotas.endpoint.used === 0) {\n      this.endpointStatus = \"noEndpoints\";\n      return;\n    }\n    if (this.quotas.endpoint.used >= 1) {\n      this.endpointStatus = \"hasEndpoints\";\n      return;\n    }\n    //default.\n    this.endpointStatus = \"hasEndpoints\";\n    return;\n  }\n\n  setCollectorStatus() {\n    if (! this.quotas) {\n      return;\n    }\n    if (this.quotas.probe.used === 0) {\n      this.collectorStatus = \"noCollectors\";\n      return;\n    }\n    if (this.quotas.probe.used >= 1) {\n      this.collectorStatus = \"hasCollectors\";\n      return;\n    }\n    //default.\n    this.collectorStatus = \"hasCollectors\";\n    return;\n  }\n\n  getOrgDetails() {\n    var self = this;\n    var p = this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/grafana-net/profile/org');\n    p.then((resp) => {\n      self.org = resp;\n      self.requiresUpgrade = self._requiresUpgrade();\n      self.aboveFreeTier = self._aboveFreeTier();\n    }, (resp) => {\n      self.alertSrv.set(\"failed to get Org Details\", resp.statusText, 'error', 10000);\n    });\n    return p;\n  }\n\n  _requiresUpgrade() {\n    if (!this.org) {\n      return true;\n    }\n\n    if (this.org.wpPlan !== '' && this.org.wpPlan !== 'free') {\n      return false;\n    }\n\n    return true;\n  }\n\n  _aboveFreeTier() {\n    if (!this.org) {\n      return false;\n    }\n\n    if (this.org.wpPlan !== '' && this.org.wpPlan !== 'free') {\n      return false;\n    }\n\n    if (this.org.checksPerMonth / 1000000 > 3) {\n      return true;\n    }\n\n    return false;\n  }\n\n  allDone() {\n    if (! this.quotas) {\n      return false;\n    }\n    if (this.quotas.probe.used === 0) {\n      return false;\n    }\n    if (this.quotas.endpoint.used === 0) {\n      return false;\n    }\n    //default.\n    return true;\n  }\n\n  refresh() {\n    var self = this;\n    return this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/quotas').then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get quotas.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      var quotaHash = {};\n      _.forEach(resp.body, function(q) {\n        quotaHash[q.target] = q;\n      });\n      self.quotas = quotaHash;\n      self.setEndpointStatus();\n      self.setCollectorStatus();\n    });\n  }\n}\n\nCallToActionCtrl.templateUrl = 'public/plugins/raintank-worldping-app/panels/call-to-action/module.html';\n\nexport {\n  CallToActionCtrl as PanelCtrl\n};\n"]}