{"version":3,"sources":["../../../src/panels/nav-panel/module.js"],"names":[],"mappings":"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","file":"module.js","sourcesContent":["import _ from 'lodash';\nimport '../../filters/all';\nimport '../../directives/all';\nimport {PanelCtrl} from 'app/plugins/sdk';\nimport {loadPluginCss} from 'app/plugins/sdk';\n\nloadPluginCss({\n  dark: 'plugins/raintank-worldping-app/css/worldping.dark.css',\n  light: 'plugins/raintank-worldping-app/css/worldping.light.css'\n});\n\nclass EndpointNavCtrl extends PanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $q, backendSrv, templateSrv, alertSrv) {\n    super($scope, $injector);\n    this.$location = $location;\n    this.$q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.alertSrv = alertSrv;\n    this.endpointSlugs = [];\n\n    $scope.ctrl.panel.title = \"\";\n    $scope.ctrl.panel.transparent = true;\n\n    this.pageReady = false;\n    this.statuses = [\n      {label: \"Ok\", value: 0},\n      {label: \"Warning\", value: 1},\n      {label: \"Error\", value: 2},\n      {label: \"Unknown\", value: -1},\n    ];\n    this.endpoints = [];\n    this.endpointState = {\n      \"0\": 0,\n      \"1\": 0,\n      \"2\": 0,\n      \"-1\": 0,\n    };\n  }\n\n  getEndpointSlugs() {\n    var values = null;\n    _.forEach(this.templateSrv.variables, function(tmplVar) {\n      if (tmplVar.name === 'endpoint') {\n        values = tmplVar.current.value;\n        if (!_.isArray(values)) {\n          values = [values];\n        }\n        values;\n      }\n    });\n    this.endpointSlugs = values;\n    return values;\n  }\n\n  refresh() {\n    var endpointSlugs = this.getEndpointSlugs();\n    this.getEndpoints(endpointSlugs);\n  }\n\n  getEndpoints(endpointSlugs) {\n    var self = this;\n    this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints').then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get endpoint list.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoints = [];\n      self.isGoogleDemo = endpointSlugs.length === 1 && endpointSlugs[0] === '~google_com_demo';\n      _.forEach(resp.body, function(endpoint) {\n        if (_.indexOf(endpointSlugs, endpoint.slug) >= 0) {\n          self.endpoints.push(endpoint);\n        }\n      });\n      self.pageReady = true;\n    });\n  }\n\n  monitorStateTxt(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!check.enabled) {\n      return \"disabled\";\n    }\n    if (check.state < 0 || check.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[check.state];\n  }\n\n  monitorStateChangeStr(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"\";\n    }\n    var duration = new Date().getTime() - new Date(check.stateChange).getTime();\n    if (duration < 10000) {\n      return \"for a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  gotoDashboard(endpoint, type) {\n    if (!type) {\n      type = 'summary';\n    }\n    var search = {\n      \"var-collector\": \"All\",\n      \"var-endpoint\": endpoint.slug\n    };\n    switch(type) {\n      case \"summary\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n      case \"ping\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-ping\").search(search);\n        break;\n      case \"dns\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-dns\").search(search);\n        break;\n      case \"http\":\n        search['var-protocol'] = \"http\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      case \"https\":\n        search['var-protocol'] = \"https\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      default:\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n    }\n  }\n\n  gotoEndpointURL(endpoint) {\n    this.$location.path('plugins/raintank-worldping-app/page/endpoint-details?endpoint='+ endpoint.id);\n  }\n}\n\nEndpointNavCtrl.templateUrl = 'public/plugins/raintank-worldping-app/panels/nav-panel/module.html';\nexport {\n  EndpointNavCtrl as PanelCtrl\n};\n"]}