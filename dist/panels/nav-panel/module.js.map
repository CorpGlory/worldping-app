{"version":3,"sources":["../../../src/panels/nav-panel/module.js"],"names":[],"mappings":"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","file":"module.js","sourcesContent":["import _ from 'lodash';\nimport '../../filters/all';\nimport '../../directives/all';\nimport {PanelCtrl} from 'app/plugins/sdk';\nimport {loadPluginCss} from 'app/plugins/sdk';\n\nloadPluginCss({\n  dark: 'plugins/raintank-worldping-app/css/worldping.dark.css',\n  light: 'plugins/raintank-worldping-app/css/worldping.light.css'\n});\n\nclass EndpointNavCtrl extends PanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, backendSrv, templateSrv) {\n    super($scope, $injector);\n    this.$location = $location;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.endpointSlugs = [];\n\n    $scope.ctrl.panel.title = \"\";\n    $scope.ctrl.panel.transparent = true;\n\n    this.pageReady = false;\n    this.statuses = [\n      {label: \"Ok\", value: 0},\n      {label: \"Warning\", value: 1},\n      {label: \"Error\", value: 2},\n      {label: \"Unknown\", value: -1},\n    ];\n    this.endpoints = [];\n    this.endpointState = {\n      \"0\": 0,\n      \"1\": 0,\n      \"2\": 0,\n      \"-1\": 0,\n    };\n  }\n\n  getEndpointSlugs() {\n    var values = null;\n    _.forEach(this.templateSrv.variables, function(tmplVar) {\n      if (tmplVar.name === 'endpoint') {\n        values = tmplVar.current.value;\n        if (!_.isArray(values)) {\n          values = [values];\n        }\n        values;\n      }\n    });\n    this.endpointSlugs = values;\n    return values;\n  }\n\n  refresh() {\n    var endpointSlugs = this.getEndpointSlugs();\n    this.getEndpoints(endpointSlugs);\n  }\n\n  isEndPointReady(endpoint) {\n    return endpoint && endpoint.hasOwnProperty('ready') &&  endpoint.ready;\n  }\n\n  getEndpoints(endpointSlugs) {\n    var self = this;\n    this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/endpoints').then(function(endpoints) {\n      self.endpoints = [];\n      self.isGoogleDemo = endpointSlugs.length === 1 && endpointSlugs[0] === '~google_com_demo';\n      _.forEach(endpoints, function(endpoint) {\n        if (_.indexOf(endpointSlugs, endpoint.slug) >= 0) {\n          self.endpoints.push(endpoint);\n          endpoint.states = [];\n          endpoint.monitors = {};\n          endpoint.ready = false;\n\n          self.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/monitors', {\"endpoint_id\": endpoint.id})\n            .then(function(monitors) {\n            var seenStates = {};\n            _.forEach(monitors, function(mon) {\n              if (!mon.enabled) {\n                return;\n              }\n              seenStates[mon.state] = true;\n              endpoint.monitors[mon.monitor_type_name.toLowerCase()] = mon;\n            });\n            for (var s in seenStates) {\n              self.endpointState[s]++;\n              endpoint.states.push(parseInt(s));\n            }\n            endpoint.ready = true;\n          });\n        }\n      });\n      self.pageReady = true;\n    });\n  }\n\n  monitorStateTxt(endpoint, type) {\n    var mon = endpoint.monitors[type];\n    if (typeof(mon) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!mon.enabled) {\n      return \"disabled\";\n    }\n    if (mon.state < 0 || mon.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[mon.state];\n  }\n\n  monitorStateChangeStr(endpoint, type) {\n    var mon = endpoint.monitors[type];\n    if (typeof(mon) !== \"object\") {\n      return \"\";\n    }\n    var duration = new Date().getTime() - new Date(mon.state_change).getTime();\n    if (duration < 10000) {\n      return \"for a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  gotoDashboard(endpoint, type) {\n    if (!type) {\n      type = 'summary';\n    }\n    var search = {\n      \"var-collector\": \"All\",\n      \"var-endpoint\": endpoint.slug\n    };\n    switch(type) {\n      case \"summary\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n      case \"ping\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-ping\").search(search);\n        break;\n      case \"dns\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-dns\").search(search);\n        break;\n      case \"http\":\n        search['var-protocol'] = \"http\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      case \"https\":\n        search['var-protocol'] = \"https\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      default:\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n    }\n  }\n\n  gotoEndpointURL(endpoint) {\n    this.$location.path('plugins/raintank-worldping-app/page/endpoint-details?endpoint='+ endpoint.id);\n  }\n}\n\nEndpointNavCtrl.templateUrl = 'public/plugins/raintank-worldping-app/panels/nav-panel/module.html';\nexport {\n  EndpointNavCtrl as PanelCtrl\n};\n"]}